<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Stylesheet documentation for: exif2NewExif.xsl</title>
      <link rel="stylesheet" href="docHtml.css" type="text/css" /><script type="text/javascript">
         <!--
        
        var parametersBoxes= new Array('prs_M_rdfDescriptionS_exif2NewExif.xsl', 
				'prs_T_newExifS_exif2NewExif.xsl', 
				'prs_T_getCMSDataS_exif2NewExif.xsl', 
				'prs_T_DAVIDdbxS_exif2NewExif.xsl');

        
        var usedByBoxes= new Array('uB_V_illegalCharactersS_exif2NewExif.xsl', 
				'uB_V_legalCharactersS_exif2NewExif.xsl');

        var docBoxes= new Array('dS_exif2NewExif.xsl', 
				'dS_M_rdfRDFstarts-withrdfDescriptionRIFFCommenthttpss3.amazonaws.comamericanarchive.orgtranscriptsS_exif2NewExif.xsl', 
				'dS_V_separatingTokenForFreeTextFieldsS_exif2NewExif.xsl');

        var sourceBoxes= new Array('src_M_rdfDescriptionS_exif2NewExif.xsl', 
				'src_T_newExifS_exif2NewExif.xsl', 
				'src_T_aapbDataS_exif2NewExif.xsl', 
				'src_T_aapbData2S_exif2NewExif.xsl', 
				'src_M_rdfRDFstarts-withrdfDescriptionRIFFCommenthttpss3.amazonaws.comamericanarchive.orgtranscriptsS_exif2NewExif.xsl', 
				'src_T_getCMSDataS_exif2NewExif.xsl', 
				'src_T_DAVIDdbxS_exif2NewExif.xsl', 
				'src_V_illegalCharactersS_exif2NewExif.xsl', 
				'src_V_legalCharactersS_exif2NewExif.xsl', 
				'src_V_CMSRolesS_exif2NewExif.xsl', 
				'src_V_validatingCatalogStringS_exif2NewExif.xsl', 
				'src_V_validatingKeywordStringS_exif2NewExif.xsl', 
				'src_V_validatingNameStringS_exif2NewExif.xsl', 
				'src_V_separatingTokenS_exif2NewExif.xsl', 
				'src_V_separatingTokenLongS_exif2NewExif.xsl', 
				'src_V_separatingTokenForFreeTextFieldsS_exif2NewExif.xsl');

        var supersedesBoxes= new Array('sps_V_illegalCharactersS_exif2NewExif.xsl', 
				'sps_V_legalCharactersS_exif2NewExif.xsl', 
				'sps_V_validatingKeywordStringS_exif2NewExif.xsl', 
				'sps_V_validatingNameStringS_exif2NewExif.xsl', 
				'sps_V_separatingTokenS_exif2NewExif.xsl', 
				'sps_V_separatingTokenLongS_exif2NewExif.xsl');

        var overridingBoxes= new Array('ovr_T_DAVIDdbxS_exif2NewExif.xsl', 
				'ovr_V_validatingKeywordStringS_exif2NewExif.xsl', 
				'ovr_V_validatingNameStringS_exif2NewExif.xsl', 
				'ovr_V_separatingTokenS_exif2NewExif.xsl', 
				'ovr_V_separatingTokenLongS_exif2NewExif.xsl', 
				'ovr_V_separatingTokenForFreeTextFieldsS_exif2NewExif.xsl');

        var referencesBoxes= new Array('refs_T_newExifS_exif2NewExif.xsl', 
				'refs_V_separatingTokenLongS_exif2NewExif.xsl');

        var importsBoxes= new Array('ip_exif2NewExif.xsl');

        
        var importedFromBoxes= new Array('ipF_exif2NewExif.xsl');

        
        var button_prefix = 'bt_';
        
        /**
        * Get all DIV elements with a specified class name.
        *
        * @param className The class name. 
        */
        function getElementsByClassName(className) {
            var results = [];
    
             if (document.getElementsByClassName == undefined) {
                var allElements = document.getElementsByTagName("div");
                var element;
                for (var i = 0; i < allElements.length; i++) {
                    var element = allElements[i];
                	var elementClass = element.className;
                	if (elementClass == className) { 
                		results.push(element);
                	}
                }
             } else {
                results = document.getElementsByClassName(className);
             }
    
            return results;
        }
            
        /**
        * Returns an element in the current HTML document.
        *
        * @param elementID Identifier of HTML element
        * @return               HTML element object
        */
        function getElementObject(elementID) {
            var elemObj = null;
            if (document.getElementById) {
                elemObj = document.getElementById(elementID);
            }
            return elemObj;
        }
        
        /**
        * Switches the state of a collapseable box, e.g.
        * if it's opened, it'll be closed, and vice versa.
        *
        * @param boxID Identifier of box
        */
        function switchState(boxID) {
            var boxObj = getElementObject(boxID);
            var buttonObj = getElementObject(button_prefix + boxID);
            if (boxObj == null || buttonObj == null) {
                // Box or button not found
            } else if (boxObj.style.display == "none") {
                // Box is closed, so open it
                openBox(boxObj, buttonObj);
            } else if (boxObj.style.display == "block") {
                // Box is opened, so close it
                closeBox(boxObj, buttonObj);
            }
        }
        
        /**
        * Opens a collapseable box.
        *
        * @param boxObj       Collapseable box
        * @param buttonObj Button controlling box
        */
        function openBox(boxObj, buttonObj) {
            if (boxObj == null || buttonObj == null) {
                // Box or button not found
            } else {
                // Change 'display' CSS property of box
                boxObj.style.display = "block";
                
                // Change text of button
                if (boxObj.style.display == "block") {
                    buttonObj.src = "img/btM.gif";
                }
            }
        }
        
        /**
        * Closes a collapseable box.
        *
        * @param boxObj       Collapseable box
        * @param buttonObj Button controlling box
        */
        function closeBox(boxObj, buttonObj) {
            if (boxObj == null || buttonObj == null) {
                // Box or button not found
            } else {
                // Change 'display' CSS property of box
                boxObj.style.display = "none";
                
                // Change text of button
                if (boxObj.style.display == "none") {
                    buttonObj.src = "img/btP.gif";
                }
            }
        }

       /**
        * Switch between the compact list representation and the clasic list representation.
        */
       function switchMode(checkBox) {
            if (checkBox == null) {
                // Checkbox not found
            } else if (checkBox.checked == 1) {
                // Compact mode
                var divs = getElementsByClassName('refItemBlock');
                for (var i = 0; i < divs.length; i ++) {
                    divs[i].style.display = "inline";
                    var children = divs[i].children;
                    var refItemSep = children[children.length - 1];
                    if (refItemSep.className == "refItemSep") {
                        children[children.length - 1].style.display = "inline";
                    }
                }
            } else {
                // Expanded mode
                var divs = getElementsByClassName('refItemBlock');
                for (var i = 0; i < divs.length; i ++) {
                    divs[i].style.display = "block";
                    var children = divs[i].children;
                    var refItemSep = children[children.length - 1];
                    if (refItemSep.className == "refItemSep") {
                        children[children.length - 1].style.display = "none";
                    }
                }
            }
        }

       function switchStateForAll(buttonObj, boxList) {
            if (buttonObj == null) {
                // button not found
            } else if (buttonObj.value == "+") {
                // Expand all
                expandAll(boxList);
                buttonObj.value = "-";
            } else if (buttonObj.value == "-") {
                // Collapse all
                collapseAll(boxList);
                buttonObj.value = "+";
            }
        }
        
        /**
        * Closes all boxes in a given list.
        *
        * @param boxList Array of box IDs
        */
        function collapseAll(boxList) {
            var idx;
            for (idx = 0; idx < boxList.length; idx++) {
                var boxObj = getElementObject(boxList[idx]);
                var buttonObj = getElementObject(button_prefix + boxList[idx]);
                closeBox(boxObj, buttonObj);
            }
        }
            
        /**
        * Open all boxes in a given list.
        *
        * @param boxList Array of box IDs
        */
        function expandAll(boxList) {
            var idx;
            for (idx = 0; idx < boxList.length; idx++) {
                var boxObj = getElementObject(boxList[idx]);
                var buttonObj = getElementObject(button_prefix + boxList[idx]);
                openBox(boxObj, buttonObj);
            }
        }
        
        /**
         * Update the message presented in the title of the html page.
         * - If the documentation was splited by namespace we present something like: "Documentation for namespace 'ns'"
         * - If the documentation was splited by location we present somehing like: "Documentation for 'Schema.xsd'"
         * - If no split we always present: "Documentation for 'MainSchema.xsd'"
         */
        function updPT(message) {
            top.document.title = "Stylesheet documentation for: " + message;
        }
        
          
                    
         /**
          * Finds an HTML element by its ID and makes it floatable over the normal content.
          *
          * @param x_displacement The difference in pixels to the right side of the window from 
          *           the left side of the element.
          * @param y_displacement The difference in pixels to the right side of the window from 
          *           the top of the element.          
          */
         function findAndFloat(id, x_displacement, y_displacement){

            var element = getElementObject(id);            
            
            window[id + "_obj"] = element;
            
            if(document.layers) {
               element.style = element;
            }
            
            element.current_y = y_displacement;      
            element.first_time = true;
         
            element.floatElement = function(){
               // It may be closed by an user action.
                
               // Target X and Y coordinates.
               var x, y;
               
               var myWidth = 0, myHeight = 0;
               if( typeof( window.innerWidth ) == 'number' ) {
                  //Non-IE
                  myWidth = window.innerWidth;
                  myHeight = window.innerHeight;
               } else if( document.documentElement && ( document.documentElement.clientWidth || document.documentElement.clientHeight ) ) {
                  //IE 6+ in 'standards compliant mode'
                  myWidth = document.documentElement.clientWidth;
                  myHeight = document.documentElement.clientHeight;
               } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
                  //IE 4 compatible
                  myWidth = document.body.clientWidth;
                  myHeight = document.body.clientHeight;
               }
               
               
               x = myWidth - x_displacement;
               
               var ns = (navigator.appName.indexOf("Netscape") != -1);               
               y = ns ? pageYOffset : document.documentElement && document.documentElement.scrollTop ? 
                  document.documentElement.scrollTop : document.body.scrollTop;               
               y = y + y_displacement;               
               
               // The current y is the current coordinate of the floating element.
               // This should be at the limit the y target coordinate.
               this.current_y += (y - this.current_y)/1.25;
               
               // Add the pixels constant after the values
               // and move the element.
               var px = document.layers ? "" : "px";
               this.style.left =  x + px;
               this.style.top =  this.current_y + px;
                              
               setTimeout(this.id + "_obj.floatElement()", 100);
            }
            
            element.floatElement();
            return element;
          }

         /**
          * Finds an HTML element by its ID and makes it floatable over the normal content.
          *
          * @param x_displacement The difference in pixels to the right side of the window from 
          *           the left side of the element.
          * @param y_displacement The difference in pixels to the right side of the window from 
          *           the top of the element.          
          */
         function selectTOCGroupBy(id){
         var selectIds = new Array('toc_group_by_location', 'toc_group_by_component_type', 'toc_group_by_namespace', 'toc_group_by_mode');
            // Make all the tabs invisible.
            for (i = 0; i < 4; i++){
               var tab = getElementObject(selectIds[i]);
               tab.style.display = 'none';
            }
            var selTab = getElementObject(id);
            selTab.style.display = 'block';            
         }
          

    
                    //--></script></head>
   <body>
      <div id="global_controls" class="globalControls" style="position:absolute;right:0;">
         <table class="rt">
            <tr>
               <td class="rt_cTL"></td>
               <td class="rt_lT"></td>
               <td class="rt_cTR"></td>
            </tr>
            <tr>
               <td class="rt_lL"></td>
               <td class="rt_cnt">
                  <h3>Mode:</h3>
                  <table>
                     <tr>
                        <td><span><input type="checkbox" value="-" checked="checked" onclick="switchMode(this);" class="control" /></span><span class="globalControlName">Compact lists</span></td>
                     </tr>
                  </table>
                  <h3>Showing:</h3>
                  <table>
                     <tr>
                        <td><span><input type="checkbox" value="-" checked="checked" onclick="switchStateForAll(this, docBoxes);" class="control" /></span><span class="globalControlName">Documentation
                              </span></td>
                     </tr>
                     <tr>
                        <td><span><input type="checkbox" value="-" checked="checked" onclick="switchStateForAll(this, parametersBoxes);" class="control" /></span><span class="globalControlName">Parameters </span></td>
                     </tr>
                     <tr>
                        <td><span><input type="checkbox" value="-" checked="checked" onclick="switchStateForAll(this, usedByBoxes);" class="control" /></span><span class="globalControlName">Used by </span></td>
                     </tr>
                     <tr>
                        <td><span><input type="checkbox" value="-" checked="checked" onclick="switchStateForAll(this, referencesBoxes);" class="control" /></span><span class="globalControlName">References </span></td>
                     </tr>
                     <tr>
                        <td><span><input type="checkbox" value="-" checked="checked" onclick="switchStateForAll(this, supersedesBoxes);" class="control" /></span><span class="globalControlName">Supersedes </span></td>
                     </tr>
                     <tr>
                        <td><span><input type="checkbox" value="-" checked="checked" onclick="switchStateForAll(this, overridingBoxes);" class="control" /></span><span class="globalControlName">Overriding </span></td>
                     </tr>
                     <tr>
                        <td><span><input type="checkbox" value="-" checked="checked" onclick="switchStateForAll(this, importsBoxes);" class="control" /></span><span class="globalControlName">Imported modules
                              </span></td>
                     </tr>
                     <tr>
                        <td><span><input type="checkbox" value="-" checked="checked" onclick="switchStateForAll(this, importedFromBoxes);" class="control" /></span><span class="globalControlName">Imported from
                              </span></td>
                     </tr>
                     <tr>
                        <td><span><input type="checkbox" value="-" checked="checked" onclick="switchStateForAll(this, sourceBoxes);" class="control" /></span><span class="globalControlName">Source </span></td>
                     </tr>
                  </table>
                  <div align="right"><span><input type="button" onclick="getElementObject('global_controls').style.display = 'none';" value="Close" /></span></div>
               </td>
               <td class="rt_lR"></td>
            </tr>
            <tr>
               <td class="rt_cBL"></td>
               <td class="rt_lB"></td>
               <td class="rt_cBR"></td>
            </tr>
         </table>
      </div><a id="exif2NewExif.xsl"></a><div class="cmpT">Stylesheet
         <span class="qname">exif2NewExif.xsl</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Documentation</div>
                           <div class="flR"><input id="bt_dS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('dS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="dS_exif2NewExif.xsl" style="display:block">
                              <div>
                                 <h3>Description</h3><pre>This script transforms output from a file 
obtained through an exiftool command of the type

    exiftool -X -a -struct "fileDirectory" &gt; "output.xml"

checks against DBX, cavafy, the CMS and other sources
and outputs a new 'mergedFields' rdf.

Data for the fields is generated 
according to the following general priority:

1. Whatever is already written in the field
2. Whatever the well-formed filename suggests
  (using WNYC Archives naming convention
  "COLL-SERIES-YYYY-MM-DD-InstantiationNo[ Free text][ GENERATION].wav")
  e.g. WNYC-NOUE-199u-uu-uu-760361.3 Perlis on Ives WEB EDIT
3. Whatever is written in the cavafy catalog record, 
   pointed to by either the iXML ISRC field 
   or the XMP catalogURL field 
   (so it is very helpful to fill either of these fields in),
   e.g. https://cavafy.wnyc.org/assets/c5fb5a14-980b-4963-9de9-29dc3f8da74a
4. Whatever data exists in the DAVID DBX files
5. Info from cavafy's corresponding series entry,
   characterised by it srelation of type 'other'
   SRSLST
   e.g. https://cavafy.wnyc.org/assets/bf7bb1c5-1840-47cf-ae09-83b36ea4135f
5. (In progress) Info from the station's CMS,
   accessed via its API
   e.g. http://www.wnyc.org/story/charles-ives-as-viewed-by-vivian-perlis
6. Data from the American Archive web site
   e.g. https://americanarchive.org/catalog/cpb-aacip_510-3n20c4t76x
7. Default or boilerplate language </pre><pre> The script checks for conflicts or merges,
depending on various factors.

Fields that must be consistent include:
Collection / IARL
Copyright / ICOP
Unique date /ICRD
Genre / IGNR
Medium /IMED
Title / INAM
Series / IPRD
Abstract / ISBJ
Software /ISFT
Source / ISRC (this may change)
Provenance / ISRF
Transfer tech / ITCH

Fields that are merged include:
Contributors / IART
Creators and publishers / ICMS
Comments / ICMT
Engineers / IENG
Subject headings / IKEY
</pre></div>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Imported modules</div>
                           <div class="flR"><input id="bt_ip_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('ip_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="ip_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter6.html#Exif2BWF.xsl" target="_self" title="No namespace" onclick="updPT('Exif2BWF.xsl')">Exif2BWF.xsl</a><span class="refItemSep">;</span></div>
                                          <div class="refItemBlock"><a href="masterRouter7.html#Exif2Cavafy.xsl" target="_self" title="No namespace" onclick="updPT('Exif2Cavafy.xsl')">Exif2Cavafy.xsl</a><span class="refItemSep">;</span></div>
                                          <div class="refItemBlock"><a href="masterRouter8.html#Exif2Dbx.xsl" target="_self" title="No namespace" onclick="updPT('Exif2Dbx.xsl')">Exif2Dbx.xsl</a><span class="refItemSep">;</span></div>
                                          <div class="refItemBlock"><a href="masterRouter10.html#cavafyQC.xsl" target="_self" title="No namespace" onclick="updPT('cavafyQC.xsl')">cavafyQC.xsl</a><span class="refItemSep">;</span></div>
                                          <div class="refItemBlock"><a href="masterRouter9.html#cms2BWFMetaEdit.xsl" target="_self" title="No namespace" onclick="updPT('cms2BWFMetaEdit.xsl')">cms2BWFMetaEdit.xsl</a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Imported from</div>
                           <div class="flR"><input id="bt_ipF_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('ipF_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="ipF_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter0.html#masterRouter.xsl" target="_self" title="No namespace" onclick="updPT('masterRouter.xsl')">masterRouter.xsl</a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">Stylesheet version</td>
                        <td>3.0</td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table><a id="M_rdfDescriptionS_exif2NewExif.xsl"></a><div class="cmpT">Template
         <span class="titleTemplateMatch">rdf:Description</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">Namespace</td>
                        <td>No namespace</td>
                     </tr>
                     <tr>
                        <td class="fCol">Match</td>
                        <td>rdf:Description</td>
                     </tr>
                     <tr>
                        <td class="fCol">Mode</td>
                        <td>#default</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Parameters</div>
                           <div class="flR"><input id="bt_prs_M_rdfDescriptionS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('prs_M_rdfDescriptionS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="prs_M_rdfDescriptionS_exif2NewExif.xsl" style="display:block">
                              <table class="attsT">
                                 <thead>
                                    <tr>
                                       <th>QName</th>
                                       <th>Namespace</th>
                                       <th>Select</th>
                                    </tr>
                                 </thead>
                                 <tr>
                                    <td class="fCol">cmsData</td>
                                    <td>No namespace</td>
                                    <td></td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">dbxData</td>
                                    <td>No namespace</td>
                                    <td></td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">dbxTheme</td>
                                    <td>No namespace</td>
                                    <td>                 concat($dbxData                 /ENTRY[contains(FILENAME, 'wnycdavidmedia')]
                                       /MOTIVE, '.mp3')
                                    </td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">originalExif</td>
                                    <td>No namespace</td>
                                    <td>.</td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">Import precedence</td>
                        <td>17</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Source</div>
                           <div class="flR"><input id="bt_src_M_rdfDescriptionS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('src_M_rdfDescriptionS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="src_M_rdfDescriptionS_exif2NewExif.xsl" style="display:block">
                              <table class="pWCont">
                                 <tr>
                                    <td width="100%"><pre><span class="tXSLEl">&lt;xsl:template</span><span class="tAN"> match=</span><span class="tAV">"rdf:Description"</span><span class="tXSLEl">&gt;</span><span class="tI">
  </span><span class="tC">&lt;!--Match standard exif output--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"originalExif"</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tC">&lt;!--obtain DBX data--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"dbxData"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">".[contains(System:Directory, 'wnycdavidmedia')]"</span><span class="tAN"> mode=</span><span class="tAV">"DAVIDdbx"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:param&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- figure out what the MP3 name is --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"dbxTheme"</span><span class="tAN"> select=</span><span class="tAV">"                 concat($dbxData                 /ENTRY[contains(FILENAME, 'wnycdavidmedia')]                 /MOTIVE, '.mp3')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tC">&lt;!--obtain CMS data via its API--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"cmsData"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"                     $dbxData/dbxData/ENTRIES/ENTRY/MOTIVE                     [. != '']                     [. != 'news_latest_newscast']"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:param&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:message</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"'Process', @rdf:about"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:message&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- If the file comes from Archives,
        check its naming convention
        and then parse it--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:if</span><span class="tAN"> test=</span><span class="tAV">"                 $dbxTheme = '.mp3'                 or                 starts-with($dbxTheme, 'archive_import')"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tC">&lt;!-- Check the WNYC Archives naming convention --&gt;</span><span class="tI">
    </span><span class="tC">&lt;!-- Parse the title or filename --&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"parsedDAVIDTitle"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tC">&lt;!-- When file is in DAVID,
                    parse its title --&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"contains(System:Directory, 'wnycdavidmedia')"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"concat(System:FileName, ' is in DAVID.')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"'Use ', concat(RIFF:Description, '.', File:FileType), 'to parse.'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"System:FileName"</span><span class="tAN"> mode=</span><span class="tAV">"parseDAVIDTitle"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"filenameToParse"</span><span class="tAN"> select=</span><span class="tAV">"concat(RIFF:Description, '.', File:FileType)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
        </span><span class="tC">&lt;!-- Otherwise, 
                    use its filename--&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:otherwise</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"System:FileName"</span><span class="tAN"> mode=</span><span class="tAV">"parseDAVIDTitle"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:otherwise&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
    </span><span class="tC">&lt;!-- The cavafy entry corresponding to the file --&gt;</span><span class="tI">
    </span><span class="tC">&lt;!-- Check that this entry is acceptable --&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"cavafyEntry"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"                         $parsedDAVIDTitle                         /parsedDAVIDTitle                         /parsedElements                         /finalCavafyEntry                         /pb:pbcoreDescriptionDocument"</span><span class="tAN"> mode=</span><span class="tAV">"cavafyQC"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"                     'parsed DAVID title: ',                     $parsedDAVIDTitle"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"                     'cavafy entry: ', $cavafyEntry"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tC">&lt;!-- The corresponding instantiation  --&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"instantiationData"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"$parsedDAVIDTitle/parsedElements/instantiationData"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
    </span><span class="tC">&lt;!-- Cavafy series data,
                with information often used as default--&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"seriesData"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$parsedDAVIDTitle//parsedElements/seriesData"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"allInputs"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tEl">&lt;inputs</span><span class="tEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:element</span><span class="tAN"> name=</span><span class="tAV">"originalExif"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:element&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$parsedDAVIDTitle"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$cavafyEntry"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tC">&lt;!--                    &lt;xsl:copy-of select="$seriesData"/&gt;--&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$instantiationData"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$dbxData"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$cmsData"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tEl">&lt;/inputs&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"newExif"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tEl">&lt;newExif</span><span class="tEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"$allInputs/inputs"</span><span class="tAN"> mode=</span><span class="tAV">"newExif"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tEl">&lt;/newExif&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
    </span><span class="tEl">&lt;result</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:attribute</span><span class="tAN"> name=</span><span class="tAV">"filename"</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/System:FileName"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$allInputs"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$newExif"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/result&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:if&gt;</span><span class="tI">
</span><span class="tXSLEl">&lt;/xsl:template&gt;</span></pre></td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table><a id="T_newExifS_exif2NewExif.xsl"></a><div class="cmpT">Template
         <span class="titleTemplateMatch">inputs</span><span class="titleTemplateName">newExif</span><span class="titleTemplateMode">newExif</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">Namespace</td>
                        <td>No namespace</td>
                     </tr>
                     <tr>
                        <td class="fCol">Match</td>
                        <td>inputs</td>
                     </tr>
                     <tr>
                        <td class="fCol">Mode</td>
                        <td>newExif</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">References</div>
                           <div class="flR"><input id="bt_refs_T_newExifS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('refs_T_newExifS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="refs_T_newExifS_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td class="fCol">Parameters</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter19.html#P_separatingTokenS_cavafySearch.xsl" target="_self" title="No namespace" onclick="updPT('cavafySearch.xsl')">separatingToken</a><span class="refItemSep">;</span></div>
                                          <div class="refItemBlock"><a href="masterRouter19.html#P_separatingTokenLongS_cavafySearch.xsl" target="_self" title="No namespace" onclick="updPT('cavafySearch.xsl')">separatingTokenLong</a></div>
                                       </div>
                                    </td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">Variables</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter15.html#V_combinedValidatingStringsS_processLoCURL.xsl" target="_self" title="No namespace" onclick="updPT('processLoCURL.xsl')">combinedValidatingStrings</a><span class="refItemSep">;</span></div>
                                          <div class="refItemBlock"><a href="masterRouter16.html#V_separatingTokenForFreeTextFieldsS_manageDuplicates.xsl" target="_self" title="No namespace" onclick="updPT('manageDuplicates.xsl')">separatingTokenForFreeTextFields</a></div>
                                       </div>
                                    </td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">Templates</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter18.html#T_ASCIIFyS_utilities.xsl" target="_self" title="No namespace" onclick="updPT('utilities.xsl')"><span class="nRf">ASCIIFy</span></a><span class="refItemSep">;</span></div>
                                          <div class="refItemBlock"><a href="masterRouter15.html#T_LOCOccupationsAndFieldsOfActivityS_processLoCURL.xsl" target="_self" title="No namespace" onclick="updPT('processLoCURL.xsl')"><span class="nRf">LOCOccupationsAndFieldsOfActivity</span></a><span class="refItemSep">;</span></div>
                                          <div class="refItemBlock"><a href="masterRouter16.html#T_checkConflictsS_manageDuplicates.xsl" target="_self" title="No namespace" onclick="updPT('manageDuplicates.xsl')"><span class="nRf">checkConflicts</span></a><span class="refItemSep">;</span></div>
                                          <div class="refItemBlock"><a href="masterRouter16.html#T_mergeDataS_manageDuplicates.xsl" target="_self" title="No namespace" onclick="updPT('manageDuplicates.xsl')"><span class="nRf">mergeData</span></a><span class="refItemSep">;</span></div>
                                          <div class="refItemBlock"><a href="masterRouter18.html#T_strip-tagsS_utilities.xsl" target="_self" title="No namespace" onclick="updPT('utilities.xsl')"><span class="nRf">strip-tags</span></a></div>
                                       </div>
                                    </td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">Functions</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter18.html#F_CapitalizeS_utilities.xsl" target="_self" title="http://www.wnyc.org" onclick="updPT('utilities.xsl')"><span>Capitalize (</span><span class="fParams">textToCapitalize, numberOflettersToCapitalize</span><span>)</span></a><span class="refItemSep">;</span></div>
                                          <div class="refItemBlock"><a href="masterRouter18.html#F_splitParseValidateS_utilities.xsl" target="_self" title="http://www.wnyc.org" onclick="updPT('utilities.xsl')"><span>splitParseValidate (</span><span class="fParams">input, separatingToken, validatingString</span><span>)</span></a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Parameters</div>
                           <div class="flR"><input id="bt_prs_T_newExifS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('prs_T_newExifS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="prs_T_newExifS_exif2NewExif.xsl" style="display:block">
                              <table class="attsT">
                                 <thead>
                                    <tr>
                                       <th>QName</th>
                                       <th>Namespace</th>
                                       <th>Select</th>
                                    </tr>
                                 </thead>
                                 <tr>
                                    <td class="fCol">cavafyEntry</td>
                                    <td>No namespace</td>
                                    <td>/inputs/parsedDAVIDTitle/parsedElements/finalCavafyEntry</td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">cmsData</td>
                                    <td>No namespace</td>
                                    <td>/inputs/cmsData</td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">dbxData</td>
                                    <td>No namespace</td>
                                    <td>/inputs/dbxData</td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">inDAVID</td>
                                    <td>No namespace</td>
                                    <td>inDAVID</td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">instantiationData</td>
                                    <td>No namespace</td>
                                    <td>/inputs/instantiationData</td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">originalExif</td>
                                    <td>No namespace</td>
                                    <td>/inputs/originalExif</td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">parsedDAVIDTitle</td>
                                    <td>No namespace</td>
                                    <td>/inputs/parsedDAVIDTitle</td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">seriesData</td>
                                    <td>No namespace</td>
                                    <td>/inputs/parsedDAVIDTitle/parsedElements/seriesData</td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">validatingCatalogString</td>
                                    <td>No namespace</td>
                                    <td>$validatingCatalogString</td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">validatingKeywordString</td>
                                    <td>No namespace</td>
                                    <td>$validatingKeywordString</td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">validatingNameString</td>
                                    <td>No namespace</td>
                                    <td>$validatingNameString</td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">Import precedence</td>
                        <td>17</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Source</div>
                           <div class="flR"><input id="bt_src_T_newExifS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('src_T_newExifS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="src_T_newExifS_exif2NewExif.xsl" style="display:block">
                              <table class="pWCont">
                                 <tr>
                                    <td width="100%"><pre><span class="tXSLEl">&lt;xsl:template</span><span class="tAN"> name=</span><span class="tAV">"newExif"</span><span class="tAN"> match=</span><span class="tAV">"inputs"</span><span class="tAN"> mode=</span><span class="tAV">"newExif"</span><span class="tXSLEl">&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Generate a new rdf:Description document 
        by merging and checking various sources --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"originalExif"</span><span class="tAN"> select=</span><span class="tAV">"/inputs/originalExif"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"parsedDAVIDTitle"</span><span class="tAN"> select=</span><span class="tAV">"/inputs/parsedDAVIDTitle"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"inDAVID"</span><span class="tAN"> select=</span><span class="tAV">"inDAVID"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"cavafyEntry"</span><span class="tAN"> select=</span><span class="tAV">"/inputs/parsedDAVIDTitle/parsedElements/finalCavafyEntry"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"seriesData"</span><span class="tAN"> select=</span><span class="tAV">"/inputs/parsedDAVIDTitle/parsedElements/seriesData"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"instantiationData"</span><span class="tAN"> select=</span><span class="tAV">"/inputs/instantiationData"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"dbxData"</span><span class="tAN"> select=</span><span class="tAV">"/inputs/dbxData"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"cmsData"</span><span class="tAN"> select=</span><span class="tAV">"/inputs/cmsData"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"validatingCatalogString"</span><span class="tAN"> select=</span><span class="tAV">"$validatingCatalogString"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"validatingKeywordString"</span><span class="tAN"> select=</span><span class="tAV">"$validatingKeywordString"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"validatingNameString"</span><span class="tAN"> select=</span><span class="tAV">"$validatingNameString"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:message</span><span class="tXSLEl">&gt;</span><span class="tT" style="white-space:normal">******** GENERATE NEW COMBINED EXIF *********</span><span class="tXSLEl">&lt;/xsl:message&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- LET THE MERGING BEGIN --&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Basics --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"filenameTranslated"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"translate($originalExif/rdf:Description/@rdf:about, '/', '\')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Asset ID --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"assetID"</span><span class="tAN"> select=</span><span class="tAV">"$parsedDAVIDTitle/parsedElements/assetID"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- MUNI ID --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"MuniID"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$parsedDAVIDTitle/parsedElements/muniNumber"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"$cavafyEntry/pb:pbcoreDescriptionDocument/pb:pbcoreIdentifier[@source = 'Municipal Archives']"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'MuniID'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Generation --&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Note: If 'Generation' includes 'segment', 
            this has consequences for the treatment of metadata.
        Specifically:
         * Embedded IART, ICMS, IKEY are not merged with 
         pbcoreContributor, pbcoreCreator and pbcoreSubject respectively; 
        but, if empty, the values come from pbcore
         * Embedded IGNR takes precedence over pbcoreGenre;
         but, if empty, the value comes from pbcore
         * Embedded INAM takes precedence over 
         pbcoreTitle[@titleType='Episode'];
         but, if empty, will append ", part [segmentsuffix]" to  
         pbcoreTitle. (E.g. 'Ravi Shankar, part b')  
         * Embedded ISBJ takes precedence over 
         pbcoreDescription[@descriptionType='Abstract'];
         but, if empty, will prepend "Part [segmentsuffix] of:" to  
         pbcoreDescription. 
         (E.g. 'Part b of: Interview and concert with Ravi Shankar')
        --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"parsedGeneration"</span><span class="tAN"> select=</span><span class="tAV">"$parsedDAVIDTitle/parsedElements/parsedGeneration"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"'Parsed generation:', $parsedGeneration"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"generation"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$parsedGeneration"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"                         $instantiationData                         /pb:pbcoreInstantiation                         /pb:instantiationGenerations"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Generation'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"'Generation: ', $generation"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"instantiationSegmentSuffix"</span><span class="tAN"> select=</span><span class="tAV">"                 $parsedDAVIDTitle                 //parsedElements/instantiationSegmentSuffix"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"segmentFlag"</span><span class="tAN"> select=</span><span class="tAV">"                 $parsedDAVIDTitle                 //parsedElements/segmentFlag"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"producingOrganizations"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tC">&lt;!-- Culled from CMS data --&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                         normalize-space(                         $cmsData                         /data/attributes/                         producing-organizations)"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                             $cmsData                             /data/attributes                             /producing-organizations/name"</span><span class="tAN"> separator=</span><span class="tAV">" ; "</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                         $cmsData                         /data/attributes                         /npr-analytics-dimensions                         [contains(lower-case(./*), 'wnyc')]"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:message</span><span class="tXSLEl">&gt;</span><span class="tT" style="white-space:normal">NPR analytics!</span><span class="tXSLEl">&lt;/xsl:message&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"'WNYC'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                         $cmsData                         /data/attributes                         /npr-analytics-dimensions                         [contains(lower-case(./*), 'wqxr')]"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:message</span><span class="tXSLEl">&gt;</span><span class="tT" style="white-space:normal">NPR analytics!</span><span class="tXSLEl">&lt;/xsl:message&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"'WQXR'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                         contains(                         $cmsData                         /data/attributes/                         headers/brand/url,                         'wqxr')"</span><span class="tXSLEl">&gt;</span><span class="tT" style="white-space:normal">WQXR</span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                         contains(                         $cmsData                         /data/attributes                         /headers/brand/url,                         'wnyc')"</span><span class="tXSLEl">&gt;</span><span class="tT" style="white-space:normal">WNYC</span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!--1. Collection (and archival location)--&gt;</span><span class="tI">
  </span><span class="tC">&lt;!--Embedded collection is of the type 'US, WNYC' 
                    So we look after the comma--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"exifCollection"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"                     $originalExif                     /rdf:Description/RIFF:Collection                     /substring-after(., ',')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"collectionInfo"</span><span class="tAN"> select=</span><span class="tAV">"                 $parsedDAVIDTitle                 /parsedElements                 /collectionData                 /collectionInfo"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"collectionURL"</span><span class="tAN"> select=</span><span class="tAV">"                 $collectionInfo                 /collURL"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"collection"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$exifCollection"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"                         $collectionInfo                         /collAcro"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field3"</span><span class="tAN"> select=</span><span class="tAV">"$producingOrganizations"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Collection'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"collectionName"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$collectionInfo/collName"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"collectionLocation"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$collectionInfo/collLocation"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:ArchivalLocation"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:ArchivalLocation</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$collection[//error]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                         concat(                         $collectionLocation, ', ',                         normalize-space($collection[not(//error)]))"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:ArchivalLocation&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- 2. Merge all Creators, Producers, Hosts, Publishers 
            as 'RIFF:Commissioned' --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"exiftoolCommissioned"</span><span class="tAN"> select=</span><span class="tAV">"                 $originalExif/rdf:Description/RIFF:Commissioned"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"assetCreatorsPublishers"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     $cavafyEntry/pb:pbcoreDescriptionDocument                     /pb:*/(pb:creator | pb:publisher)                     /@ref[contains(., $validatingNameString)]"</span><span class="tAN"> separator=</span><span class="tAV">"{$separatingTokenLong}"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"cmsPeople"</span><span class="tAN"> select=</span><span class="tAV">"                 $cmsData/data/attributes                 /appearances"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"cmsCreators"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     $cmsPeople/(producers | authors | hosts)/name"</span><span class="tAN"> separator=</span><span class="tAV">"{$separatingTokenLong}"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"seriesCreatorsPublishers"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     $seriesData/pb:pbcoreDescriptionDocument                     /pb:*/(pb:creator | pb:publisher)                     /@ref[contains(., $validatingNameString)]"</span><span class="tAN"> separator=</span><span class="tAV">"{$separatingTokenLong}"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"                 'seriesCreatorsPublishers: ',                 $seriesCreatorsPublishers"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"defaultCreatorsPublishers"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     if                     ($seriesCreatorsPublishers != '')                     then                         $seriesCreatorsPublishers                     else                         $collectionURL"</span><span class="tAN"> separator=</span><span class="tAV">" ; "</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"                 'defaultCreatorsPublishers: ',                 $defaultCreatorsPublishers"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"mergedCommissioned"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"mergeData"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$exiftoolCommissioned"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"$assetCreatorsPublishers"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field3"</span><span class="tAN"> select=</span><span class="tAV">"$cmsCreators"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$defaultCreatorsPublishers"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"validatingString"</span><span class="tAN"> select=</span><span class="tAV">"$combinedValidatingStrings"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Creators'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:Commissioned"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:comment</span><span class="tAN"> select=</span><span class="tAV">"'Exif commissioned: ', $exiftoolCommissioned"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:comment</span><span class="tAN"> select=</span><span class="tAV">"'Cavafy creators and publishers: ', $assetCreatorsPublishers"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:comment</span><span class="tAN"> select=</span><span class="tAV">"'CMS creators: ', $cmsCreators"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:Commissioned</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"not(contains($generation, 'segment'))"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$mergedCommissioned"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:otherwise</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"mergeData"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$exiftoolCommissioned"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$mergedCommissioned"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"validatingString"</span><span class="tAN"> select=</span><span class="tAV">"$combinedValidatingStrings"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Creators'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:otherwise&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:Commissioned&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- 3. Contributors as RIFF:Artist --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"exiftoolArtists"</span><span class="tAN"> select=</span><span class="tAV">"             $originalExif/rdf:Description/RIFF:Artist"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"cavafyContributors"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     $cavafyEntry/pb:pbcoreDescriptionDocument                     /pb:pbcoreContributor/pb:contributor                     /@ref[contains(., $validatingNameString)]"</span><span class="tAN"> separator=</span><span class="tAV">"{$separatingTokenLong}"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"cmsContributors"</span><span class="tAN"> select=</span><span class="tAV">"                 $cmsData/data                 /attributes                 /appearances/contributors/name"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"cmsHosts"</span><span class="tAN"> select=</span><span class="tAV">"                 $cmsData/data                 /attributes                 /appearances/hosts/name"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"cmsEditors"</span><span class="tAN"> select=</span><span class="tAV">"                 $cmsData                 /data                 /attributes                 /appearances                 /*[contains(name(.), 'Editor')]                 /name"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"cmsGuests"</span><span class="tAN"> select=</span><span class="tAV">"                 $cmsData/data                 /attributes                 /appearances/guests/name"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"cmsAllContributors"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     fn:distinct-values(                     $cmsContributors                     | $cmsEditors                     | $cmsGuests                     | $cmsHosts                     )"</span><span class="tAN"> separator=</span><span class="tAV">"{$separatingTokenLong}"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"seriesContributors"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     $seriesData/pb:pbcoreDescriptionDocument                     /pb:pbcoreContributor/pb:contributor                     /@ref[contains(., $validatingNameString)]"</span><span class="tAN"> separator=</span><span class="tAV">"{$separatingTokenLong}"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"defaultArtists"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     if                     ($seriesContributors ne '')                     then                         $seriesContributors                     else                         $collectionURL"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:Artist"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:comment</span><span class="tAN"> select=</span><span class="tAV">"'Exif artists: ', $exiftoolArtists"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:comment</span><span class="tAN"> select=</span><span class="tAV">"'Cavafy contributors: ', $cavafyContributors"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:comment</span><span class="tAN"> select=</span><span class="tAV">"'CMS contributors: ', $cmsContributors"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"mergedArtists"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"mergeData"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$exiftoolArtists"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"$cavafyContributors"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field3"</span><span class="tAN"> select=</span><span class="tAV">"$cmsAllContributors"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$defaultArtists"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"validatingString"</span><span class="tAN"> select=</span><span class="tAV">"$validatingNameString"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Contributors'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:Artist</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"not(contains($generation, 'segment'))"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$mergedArtists"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"contains($generation, 'segment')"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"segmentArtistWarning"</span><span class="tAN"> select=</span><span class="tAV">"                             'Make sure the artists for',                              $parsedDAVIDTitle/parsedElements/DAVIDTitle,                              'segment are right!'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"$segmentArtistWarning"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:comment</span><span class="tAN"> select=</span><span class="tAV">"$segmentArtistWarning"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"mergeData"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"                                     $exiftoolArtists"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$mergedArtists"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"validatingString"</span><span class="tAN"> select=</span><span class="tAV">"$validatingNameString"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Contributors'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:Artist&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"contributorsAsXMP"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;rdf:bag</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:for-each</span><span class="tAN"> select=</span><span class="tAV">"                         analyze-string(                         $RIFF:Artist/RIFF:Artist, $separatingToken)                         /fn:non-match/normalize-space(.)[. ne '']                         "</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tEl">&lt;rdf:li</span><span class="tEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tEl">&lt;/rdf:li&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:for-each&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/rdf:bag&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- 4. Relevant date --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:DateCreated"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:DateCreated</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     translate(                     $parsedDAVIDTitle/parsedElements/DAVIDTitleDateTranslated,                      ':', '-'                     )"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:DateCreated&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- 5. Genre --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"seriesGenre"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                 $seriesData                 //pb:pbcoreDescriptionDocument                 /pb:pbcoreGenre"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:Genre"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:Genre</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"not(contains($generation, 'segment'))"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$originalExif                                 /rdf:Description/RIFF:Genre"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"$cavafyEntry                                 /pb:pbcoreDescriptionDocument/pb:pbcoreGenre"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$seriesGenre"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Genre'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:otherwise</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"segmentGenreWarning"</span><span class="tAN"> select=</span><span class="tAV">"'Make sure the genre for',                              $parsedDAVIDTitle/parsedElements/DAVIDTitle,                              'segment is right!'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"$segmentGenreWarning"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:comment</span><span class="tAN"> select=</span><span class="tAV">"$segmentGenreWarning"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/RIFF:Genre"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$cavafyEntry                                 /pb:pbcoreDescriptionDocument/pb:pbcoreGenre"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Genre'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:otherwise&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:Genre&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!--Title--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"ASCIIfiedCavafyTitle"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"ASCIIFy"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"inputText"</span><span class="tAN"> select=</span><span class="tAV">"                         $cavafyEntry/pb:pbcoreDescriptionDocument                         /pb:pbcoreTitle[@titleType = 'Episode']"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"ASCIIfiedExifTitle"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"ASCIIFy"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"inputText"</span><span class="tAN"> select=</span><span class="tAV">"                         $originalExif/rdf:Description/RIFF:Title"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:Title"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tC">&lt;!--This is dealt differently when audio is a segment--&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:Title</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tC">&lt;!--Audio is not a segment--&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"not(contains($generation, 'segment'))"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"                                     $ASCIIfiedExifTitle                                     /ASCIIResult/ASCIIFiedText"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"                                     $ASCIIfiedCavafyTitle                                     /ASCIIResult/ASCIIFiedText"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"                                     'Title'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tC">&lt;!-- To avoid semicolons separating a single field --&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"separatingToken"</span><span class="tAN"> select=</span><span class="tAV">"                                     $separatingTokenForFreeTextFields"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
        </span><span class="tC">&lt;!--Audio is a clip or segment--&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:otherwise</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"warningMessage"</span><span class="tAN"> select=</span><span class="tAV">"                                 'Make sure the title for',                                 $parsedDAVIDTitle/parsedElements/DAVIDTitle,                                 'segment is right!'                                 "</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"$warningMessage"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:comment</span><span class="tAN"> select=</span><span class="tAV">"$warningMessage"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"defaultSegmentTitle"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tC">&lt;!-- Create a default segment title based on an existing asset title--&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:if</span><span class="tAN"> test=</span><span class="tAV">"$ASCIIfiedCavafyTitle/ASCIIResult/ASCIIFiedText != ''"</span><span class="tXSLEl">&gt;</span><span class="tI">
              </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$ASCIIfiedCavafyTitle/ASCIIResult/ASCIIFiedText"</span><span class="tXSLEl">/&gt;</span><span class="tI">
              </span><span class="tC">&lt;!-- Add the part bit to the default title --&gt;</span><span class="tI">
              </span><span class="tC">&lt;!-- From the instantiation segment bit --&gt;</span><span class="tI">
              </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                                         $instantiationSegmentSuffix/concat(', Part ', $instantiationSegmentSuffix)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
              </span><span class="tC">&lt;!-- ...or from the segment flag --&gt;</span><span class="tI">
              </span><span class="tXSLEl">&lt;xsl:if</span><span class="tAN"> test=</span><span class="tAV">"empty($instantiationSegmentSuffix)"</span><span class="tXSLEl">&gt;</span><span class="tI">
                </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$segmentFlag/concat(' (', ., ')')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
              </span><span class="tXSLEl">&lt;/xsl:if&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;/xsl:if&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"                                     $ASCIIfiedExifTitle                                     /ASCIIResult                                     /ASCIIFiedText"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$defaultSegmentTitle"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'SegmentTitle'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"separatingToken"</span><span class="tAN"> select=</span><span class="tAV">"$separatingTokenForFreeTextFields"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:otherwise&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:Title&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!--Description as RIFF:Subject--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"ASCIIfiedExifSubject"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"ASCIIFy"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"inputText"</span><span class="tAN"> select=</span><span class="tAV">"                         normalize-space($originalExif/rdf:Description/RIFF:Subject)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"ASCIIfiedCavafyAbstract"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"ASCIIFy"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"inputText"</span><span class="tAN"> select=</span><span class="tAV">"                         $cavafyEntry                         /pb:pbcoreDescriptionDocument                         /pb:pbcoreDescription                         [@descriptionType = 'Abstract']                         [. ne 'No Description available']                         [not(//error)]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"                 'ASCIIFied Asbtract: ',                 $ASCIIfiedCavafyAbstract"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"defaultAbstract"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     if ($ASCIIfiedCavafyAbstract/ASCIIResult/ASCIIFiedText != '')                     then                         $ASCIIfiedCavafyAbstract/ASCIIResult/ASCIIFiedText                     else                         concat(                         $cavafyEntry/pb:pbcoreDescriptionDocument/pb:pbcoreTitle[@titleType = 'Episode'],                         ' on ',                         $cavafyEntry/pb:pbcoreDescriptionDocument/pb:pbcoreTitle[@titleType = 'Series'],                         ' on ',                         $parsedDAVIDTitle/parsedElements/DAVIDTitleDate)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"description"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tC">&lt;!--This is dealt differently when audio is a segment--&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tC">&lt;!-- Audio is not a clip--&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"not(contains($generation, 'segment'))"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$ASCIIfiedExifSubject/ASCIIResult/ASCIIFiedText"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"                             $ASCIIfiedCavafyAbstract/ASCIIResult/ASCIIFiedText"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Description'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tC">&lt;!-- To avoid semicolons separating a single field --&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"separatingToken"</span><span class="tAN"> select=</span><span class="tAV">"$separatingTokenForFreeTextFields"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$defaultAbstract"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tC">&lt;!-- Audio is a clip or segment --&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"contains($generation, 'segment')"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"warningMessage"</span><span class="tAN"> select=</span><span class="tAV">"                             'Make sure the description for',                             $parsedDAVIDTitle/parsedElements/DAVIDTitle,                             'segment is right!'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"$warningMessage"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:comment</span><span class="tAN"> select=</span><span class="tAV">"$warningMessage"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"defaultSegmentDescription"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tC">&lt;!-- Create a default segment description based on an existing asset title--&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:if</span><span class="tAN"> test=</span><span class="tAV">"                                 $ASCIIfiedCavafyAbstract/ASCIIResult/ASCIIFiedText != ''"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tC">&lt;!-- Add the segment bits --&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                                     if ($instantiationSegmentSuffix)                                     then                                         concat('Part ', $instantiationSegmentSuffix, ' of: 
')                                     else                                         if ($segmentFlag)                                         then                                             concat($segmentFlag, ' OF: 
')                                         else                                             ''"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                                     $defaultAbstract                                     "</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:if&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"                                 $ASCIIfiedExifSubject                                 /ASCIIResult/ASCIIFiedText"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$defaultSegmentDescription"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"separatingToken"</span><span class="tAN"> select=</span><span class="tAV">"$separatingTokenForFreeTextFields"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'SegmentDescription'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"descriptionNoHtml"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"strip-tags"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"text"</span><span class="tAN"> select=</span><span class="tAV">"                     $description[not(//error)]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$description[//error]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:Subject"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:Subject</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$descriptionNoHtml"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:Subject&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!--Medium--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"pbcorePhysicalMediums"</span><span class="tAN"> select=</span><span class="tAV">"             doc('http://metadataregistry.org/vocabulary/show/id/462.xsd')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"cavafyFormats"</span><span class="tAN"> select=</span><span class="tAV">"             doc('cavafyFormats.xml')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"acceptableMediums"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"'Audio material|'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                 $cavafyFormats/cavafyFormats/format"</span><span class="tAN"> separator=</span><span class="tAV">"|"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"             $acceptableMediums"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"defaultMedium"</span><span class="tAN"> select=</span><span class="tAV">"                 if ($collection eq 'MUNI')                 then                     $parsedDAVIDTitle                     /parsedElements                     /MUNIMedium                 else                     'audio material'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"originalMedium"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"mergeData"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/RIFF:Medium"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$defaultMedium"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Medium'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:Medium"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:Medium</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"capitalizedMedium"</span><span class="tAN"> select=</span><span class="tAV">"                     WNYC:Capitalize($originalMedium, 1)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:if</span><span class="tAN"> test=</span><span class="tAV">"                     not(                     matches(                     $capitalizedMedium,                      $acceptableMediums))"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:element</span><span class="tAN"> name=</span><span class="tAV">"error"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:attribute</span><span class="tAN"> name=</span><span class="tAV">"type"</span><span class="tAN"> select=</span><span class="tAV">"unacceptableMedium"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                             'Medium', $capitalizedMedium,                              'is not an acceptable medium.',                              'Acceptable mediums include',                              $acceptableMediums"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:element&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:if&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"WNYC:Capitalize($originalMedium, 1)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:Medium&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Series as RIFF:Product--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:Product"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:Product</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/RIFF:Product"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"$cavafyEntry/pb:pbcoreDescriptionDocument/pb:pbcoreTitle[@titleType = 'Series']"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field3"</span><span class="tAN"> select=</span><span class="tAV">"$parsedDAVIDTitle/parsedElements/seriesName"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Series'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:Product&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- cavafy URL as RIFF:Source--&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- the cavafy URL has historically been embedded in different places --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"embeddedCatalogURL"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"                         $originalExif                         /rdf:Description                         /RIFF:Source                         [contains(., $validatingCatalogString)]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"                         $originalExif                         /rdf:Description                         /XMP-WNYCSchema:CatalogURL                         [contains(., $validatingCatalogString)]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field3"</span><span class="tAN"> select=</span><span class="tAV">"                         $originalExif                         /rdf:Description                         /RIFF:Comment                         [starts-with(., $validatingCatalogString)]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field4"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"                             analyze-string(                             $originalExif                             /rdf:Description                             /RIFF:Comment                             [starts-with(., 'For additional details')],                             concat($validatingCatalogString, '[0-z,-]*')                             )                             /fn:match[1]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:with-param&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'embeddedURL'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"''"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:Source"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:Source</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"$originalExif/rdf:Description/File:FileType = 'NEWASSET'"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tC">&lt;!-- There is no cavafy asset yet, so we give it a search URL --&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"             concat('https://cavafy.wnyc.org/?q=', $parsedDAVIDTitle/parsedElements/assetID, '&amp;search_fields[]=identifier')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:otherwise</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$embeddedCatalogURL"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"$parsedDAVIDTitle/parsedElements/finalCavafyURL"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'CatalogURL'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:otherwise&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:Source&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Copyright info --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"ASCIIFiedExifCopyright"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"ASCIIFy"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"inputText"</span><span class="tAN"> select=</span><span class="tAV">"                         $originalExif                         /rdf:Description                         /RIFF:Copyright"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"ASCIIFiedCavafyCopyright"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"ASCIIFy"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"inputText"</span><span class="tAN"> select=</span><span class="tAV">"                         $cavafyEntry                         /pb:pbcoreDescriptionDocument                         /pb:pbcoreRightsSummary                         /pb:rightsSummary"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"ASCIIFiedSeriesCopyright"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"ASCIIFy"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"inputText"</span><span class="tAN"> select=</span><span class="tAV">"                         $seriesData                         /pb:pbcoreDescriptionDocument                         /pb:pbcoreRightsSummary                         /pb:rightsSummary"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"defaultCopyright"</span><span class="tAN"> select=</span><span class="tAV">"             if ($ASCIIFiedSeriesCopyright/ASCIIResult/ASCIIFiedText != '')                 then                 $ASCIIFiedSeriesCopyright/ASCIIResult/ASCIIFiedText                 else                     concat(                     'Terms of Use and Reproduction: ',                     $parsedDAVIDTitle/parsedElements/collectionName, '.',                     ' Additional copyright may apply to musical selections.')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:Copyright"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:Copyright</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$ASCIIFiedExifCopyright/ASCIIResult/ASCIIFiedText"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"$ASCIIFiedCavafyCopyright/ASCIIResult/ASCIIFiedText"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$defaultCopyright"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Copyright'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tC">&lt;!-- To avoid semicolons separating a single field --&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"separatingToken"</span><span class="tAN"> select=</span><span class="tAV">"$separatingTokenForFreeTextFields"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:Copyright&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Software --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:Software"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:Software</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                         if                         (normalize-space($originalExif/rdf:Description/RIFF:Software))                         then                             normalize-space($originalExif/rdf:Description/RIFF:Software)                         else                             'Unknown software'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:Software&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Provenance as RIFF:SourceForm--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"defaultProvenance"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"$collection = 'MUNI'"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"concat('BWF created from the original WNYC Municipal Archives ', $originalMedium)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:otherwise</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"concat($collectionName, ' ', $originalMedium, ' ', $generation, ' from ', $assetID)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:otherwise&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"cavafyProvenance"</span><span class="tAN"> select=</span><span class="tAV">"$cavafyEntry/pb:pbcoreDescriptionDocument/pb:pbcoreAnnotation[@annotationType = 'Provenance'][. ne '']"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"exifProvenance"</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/RIFF:SourceForm"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"provenance"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$cavafyProvenance"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"$exifProvenance"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$defaultProvenance"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Provenance'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:SourceForm"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:SourceForm</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$provenance"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:SourceForm&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Engineers and Technicians --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"seriesEngineers"</span><span class="tAN"> select=</span><span class="tAV">"                 $seriesData/pb:pbcoreDescriptionDocument                 /pb:pbcoreContributor/pb:contributor                 [contains(contributorRole, 'ngineer')]/contributor"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"defaultEngineers"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     if                     ($seriesEngineers)                     then                         $seriesEngineers                     else                         'Unknown engineer'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDEngineers"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     distinct-values(                     $dbxData/ENTRY/(AUTHOR | EDITOR))"</span><span class="tAN"> separator=</span><span class="tAV">" ; "</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:Engineer"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:Engineer</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"mergeData"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"                             $originalExif/rdf:Description/                             RIFF:Engineer"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"                             $cavafyEntry/pb:pbcoreDescriptionDocument                             /pb:pbcoreContributor/pb:contributor                             [contains(contributorRole, 'ngineer')]                             /contributor"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field3"</span><span class="tAN"> select=</span><span class="tAV">"$DAVIDEngineers"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$defaultEngineers"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Engineers'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:Engineer&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"defaultTechnician"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/RIFF:Originator"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"$dbxData/ENTRY/CREATOR"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"'ARCHIVES'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'DefaultTechnician'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:Technician"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:Technician</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"                             $originalExif/rdf:Description                             /RIFF:Technician"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$defaultTechnician"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Technician'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:Technician&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Coding history --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:CodingHistory"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"goodExifCodingHistory"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                         normalize-space(                         $originalExif/rdf:Description                         /RIFF:CodingHistory                         [not(contains(., 'D.A.V.I.D'))]                         [not(contains(., 'udio material'))]                         )"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"defaultCodingHistory"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                         concat(                         'Transfer from ',                         $parsedDAVIDTitle/parsedElements/collectionName,                         ' ', $originalMedium, '.'                         )"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:CodingHistory</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$goodExifCodingHistory"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$defaultCodingHistory"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"separatingToken"</span><span class="tAN"> select=</span><span class="tAV">"$separatingTokenForFreeTextFields"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'CodingHistory'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:if</span><span class="tAN"> test=</span><span class="tAV">"                         $originalExif/rdf:Description/XMP-WNYCSchema:Stylus_size                         and                         not(                         contains($originalExif/rdf:Description/RIFF:CodingHistory, 'Stylus size:')                         )"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                             concat(                             '
Stylus size: ',                             $originalExif/rdf:Description/XMP-WNYCSchema:Stylus_size                             )"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:if&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:if</span><span class="tAN"> test=</span><span class="tAV">"                         $originalExif/rdf:Description/XMP-WNYCSchema:LF_turnover                         and                         not(                         contains($originalExif/rdf:Description/RIFF:CodingHistory, 'Turnover:')                         )"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                             concat(                             '
Turnover: ',                             rdf:Description/XMP-WNYCSchema:LF_turnover, ' Hz'                             )"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:if&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:if</span><span class="tAN"> test=</span><span class="tAV">"                         $originalExif                         /rdf:Description                         /XMP-WNYCSchema:Tag_0kHz_att                         and                         not(                         contains(                         $originalExif                         /rdf:Description                         /RIFF:CodingHistory,                         'Att. at 10kHz'                         )                         )"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                             concat(                             '
Att. at 10kHz: ',                             $originalExif                             /rdf:Description                             /XMP-WNYCSchema:Tag_0kHz_att,                             ' dB'                             )"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:if&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:if</span><span class="tAN"> test=</span><span class="tAV">"                         $originalExif                         /rdf:Description                         /XMP-WNYCSchema:Rumble_filter                         and                         not(                         contains(                         $originalExif                         /rdf:Description                         /RIFF:CodingHistory,                         'Rumble filter'                         ))"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                             concat(                             '
Rumble filter: ',                             $originalExif                             /rdf:Description                             /XMP-WNYCSchema:Rumble_filter,                             ' Hz'                             )"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:if&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:CodingHistory&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Transcript --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"transcript"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"exifTranscript"</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/XMP-xmpDM:Lyrics"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"cavafyTranscript"</span><span class="tAN"> select=</span><span class="tAV">"                     $cavafyEntry/pb:pbcoreDescriptionDocument/                     pb:pbcoreDescription[@descriptionType = 'Transcript']"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"$exifTranscript"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:comment</span><span class="tAN"> select=</span><span class="tAV">"'exif Transcript found'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                                 contains(                                 $cavafyTranscript, $exifTranscript)"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$cavafyTranscript"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:otherwise</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$exifTranscript"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:otherwise&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"$cavafyTranscript"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$cavafyTranscript"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!--Subject headings and keywords--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"cavafySubjects"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     $cavafyEntry/pb:pbcoreDescriptionDocument                     /pb:pbcoreSubject                     /@ref[matches(., $combinedValidatingStrings)]"</span><span class="tAN"> separator=</span><span class="tAV">"{$separatingTokenLong}"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"exifKeywords"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     $originalExif/rdf:Description/RIFF:Keywords"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Artist names and fields of activity
        as subjects--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"LOCOccupationsAndFieldsOfActivity"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"LOCOccupationsAndFieldsOfActivity"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"artists"</span><span class="tAN"> select=</span><span class="tAV">"                         $RIFF:Artist/RIFF:Artist"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"exifSubjectsAndKeywords"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     $exifKeywords[. != ''] |                     $LOCOccupationsAndFieldsOfActivity[. != '']"</span><span class="tAN"> separator=</span><span class="tAV">"{$separatingTokenLong}"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"subjectsKeywordsOccupationsAndFieldsOfActivity"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     $cavafySubjects[. != ''] |                     $exifKeywords[. != ''] |                     $LOCOccupationsAndFieldsOfActivity[. != '']"</span><span class="tAN"> separator=</span><span class="tAV">"{$separatingTokenLong}"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"             'Narrowize',              $subjectsKeywordsOccupationsAndFieldsOfActivity"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"exifSubjectsAndKeywordsNarrowed"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"                     $exifSubjectsAndKeywords"</span><span class="tAN"> mode=</span><span class="tAV">"                 narrowSubjects"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"subjectsAndKeywordsNarrowed"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"$subjectsKeywordsOccupationsAndFieldsOfActivity"</span><span class="tAN"> mode=</span><span class="tAV">"                 narrowSubjects"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"seriesSubjectsRef"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     $seriesData/pb:pbcoreDescriptionDocument                     /pb:pbcoreSubject                     /@ref[matches(., $combinedValidatingStrings)]"</span><span class="tAN"> separator=</span><span class="tAV">"{$separatingTokenLong}"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"exifSubjectsAndKeywordsNarrowedRef"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     $exifSubjectsAndKeywordsNarrowed                     /madsrdf:*/@rdf:about                     [matches(., $combinedValidatingStrings)]"</span><span class="tAN"> separator=</span><span class="tAV">"{$separatingTokenLong}"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"subjectsAndKeywordsNarrowedRef"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     $subjectsAndKeywordsNarrowed                     /madsrdf:*/@rdf:about                     [matches(., $combinedValidatingStrings)]"</span><span class="tAN"> separator=</span><span class="tAV">"{$separatingTokenLong}"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"assetKeywords"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"mergeData"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                             $subjectsAndKeywordsNarrowedRef                             "</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:with-param&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"                         $seriesSubjectsRef"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Keywords'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"assetKeywordsRDFBag"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;rdf:bag</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:for-each</span><span class="tAN"> select=</span><span class="tAV">"                         WNYC:splitParseValidate(                         $assetKeywords, ';', $combinedValidatingStrings                         )/valid"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:element</span><span class="tAN"> name=</span><span class="tAV">"rdf:li"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:element&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:for-each&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/rdf:bag&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:comment</span><span class="tAN"> select=</span><span class="tAV">"                 'Exif keywords: ', $exifKeywords"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:comment</span><span class="tAN"> select=</span><span class="tAV">"                 'Cavafy subject headings: ', $cavafySubjects"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"segmentKeywords"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"mergeData"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                             $exifSubjectsAndKeywordsNarrowedRef                             "</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:with-param&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"                         $assetKeywords"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"                         'segmentKeywords'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"segmentKeywordsRDFBag"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;rdf:bag</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:for-each</span><span class="tAN"> select=</span><span class="tAV">"                         WNYC:splitParseValidate(                         $segmentKeywords, ';', $combinedValidatingStrings                         )/valid"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:element</span><span class="tAN"> name=</span><span class="tAV">"rdf:li"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:element&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:for-each&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/rdf:bag&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:Keywords"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                         not(                         contains($generation, 'segment')                         )"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tEl">&lt;RIFF:Keywords</span><span class="tEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$assetKeywords"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tEl">&lt;/RIFF:Keywords&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:otherwise</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"message"</span><span class="tAN"> select=</span><span class="tAV">"concat(                             'Make sure the keywords for ',                             $parsedDAVIDTitle                             /parsedElements                             /DAVIDTitle,                             ' segment are right!'                             )"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"$message"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:comment</span><span class="tAN"> select=</span><span class="tAV">"$message"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tEl">&lt;RIFF:Keywords</span><span class="tEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                                 $segmentKeywords"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tEl">&lt;/RIFF:Keywords&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:otherwise&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Various and sundry comments --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:Comment"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tC">&lt;!-- The original embedded comment --&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"exifComment"</span><span class="tAN"> select=</span><span class="tAV">"                     $originalExif                     /rdf:Description                     /RIFF:Comment"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tC">&lt;!-- Embedded cavafy-url comment --&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"cavafyURLComment"</span><span class="tAN"> select=</span><span class="tAV">"                     $RIFF:Source                     [starts-with(., $validatingCatalogString)]                     /concat('For additional details see ', .)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tC">&lt;!-- Approximate date comment --&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"approximateDateComment"</span><span class="tAN"> select=</span><span class="tAV">"                     if (                     contains($parsedDAVIDTitle/parsedElements/DAVIDTitleDate, 'u')                     )                     then                         concat(                         '
Date is approximate. Given date is ',                         $parsedDAVIDTitle/parsedElements/DAVIDTitleDate, '.'                         )                     else                         ''"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tC">&lt;!-- AAPB Additions --&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"aapbURLInSource"</span><span class="tAN"> select=</span><span class="tAV">"                     $originalExif/rdf:Description/RIFF:Source                     [contains(., '//americanarchive.org/catalog/')]                     /concat('
American Archive catalog entry available at: ', .)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"aapbTranscriptURLInComment"</span><span class="tAN"> select=</span><span class="tAV">"                     $originalExif/rdf:Description/RIFF:Comment                     [starts-with(., 'https://s3.amazonaws.com/americanarchive.org/transcripts/')]                     /concat('
Automated transcript available from ', .)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:Comment</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:if</span><span class="tAN"> test=</span><span class="tAV">"contains($exifComment, 'Date is approximate.')                     and                      not(                     contains(                     $parsedDAVIDTitle/parsedElements/DAVIDTitleDate, 'u')                     )"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"dateNotApproximateMessage"</span><span class="tAN"> select=</span><span class="tAV">"                         'ATTENTION!',                         'Embedded comment', $exifComment,                         'implies an approximate date.',                         'But in fact the date is',                         $parsedDAVIDTitle/parsedElements/DAVIDTitleDate                         "</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"$dateNotApproximateMessage"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:element</span><span class="tAN"> name=</span><span class="tAV">"error"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:attribute</span><span class="tAN"> name=</span><span class="tAV">"type"</span><span class="tAN"> select=</span><span class="tAV">"'dateNotApproximate'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$dateNotApproximateMessage"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:element&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:if&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$exifComment"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                         $cavafyURLComment                         [not(                         contains(                         $exifComment, 'For additional details see https://cavafy.')                         )]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                         $approximateDateComment                         [not(                         contains(                         $exifComment, 'Date is approximate')                         )]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                         $aapbURLInSource                         [not(                         contains(                         $exifComment, 'American Archive catalog entry available at: ')                         )]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                         $aapbTranscriptURLInComment                         [not(                         contains(                         $exifComment, 'Automated transcript available from')                         )]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:Comment&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!--                Originator field; not to be trusted much in DAVID--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:Originator"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:Originator</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:Technician"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:text</span><span class="tXSLEl">&gt;</span><span class="tT">
</span><span class="tXSLEl">&lt;/xsl:text&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:Originator&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!--  Originator reference field; 
            not to be trusted much in DAVID,
        as it often gets wiped out--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"RIFF:OriginatorReference"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tEl">&lt;RIFF:OriginatorReference</span><span class="tEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"concat('Catalog number ', $assetID)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tEl">&lt;/RIFF:OriginatorReference&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Other potentially useful variables: 
            CMS Image ID, Transcript, Coverage --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"defaultCMSImageID"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                         $seriesData/pb:pbcoreDescriptionDocument                         /pb:pbcoreAnnotation                         [@annotationType = 'CMS Image']                         ne ''"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                             $seriesData/pb:pbcoreDescriptionDocument                             /pb:pbcoreAnnotation                             [@annotationType = 'CMS Image']"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"contains($originalMedium, 'disc')"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"'166809'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:otherwise</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"'154339'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:otherwise&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"cmsImageID"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"inputs"</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"                         $originalExif/rdf:Description                         /XMP-plus:ImageSupplierImageID                         /fn:normalize-space(.)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"                         $originalExif/rdf:Description                         /XMP-WNYCSchema:ImageCMS                         /fn:normalize-space(.)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field3"</span><span class="tAN"> select=</span><span class="tAV">"                         $cavafyEntry/pb:pbcoreDescriptionDocument                         /pb:pbcoreAnnotation                         [@annotationType = 'CMS Image']"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$defaultCMSImageID"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'CMSImageID'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"aapbTranscriptURL"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     $originalExif/rdf:Description                     /RIFF:Comment                     [starts-with(                     ., 'https://s3.amazonaws.com/americanarchive.org/transcripts/'                     )]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"aapbTranscriptFromCommentField"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"                     $originalExif/rdf:Description                     /RIFF:Comment                     [starts-with(                     ., 'https://s3.amazonaws.com/americanarchive.org/transcripts/'                     )]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Location coordinates as XMP-dc:Coverage --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"googleLocation"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     $originalExif/rdf:Description                     /XMP-dc:Coverage"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"exifCoordinates"</span><span class="tAN"> select=</span><span class="tAV">"                 concat(                 substring-before(substring-after($googleLocation, '@'), ','),                 ',',                 substring-before(substring-after(substring-after(@location, '@'), ','), ',')                 )"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"cavafyCoordinates"</span><span class="tAN"> select=</span><span class="tAV">"                 $cavafyEntry/pb:pbcoreDocument                 /pb:pbcoreCoverage[pb:coverageType eq 'Spatial']                 /pb:coverage[matches(., '[0-9]+.*[0-9]*, *\-*[0-9]+.*[0-9]*')]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"seriesCoordinates"</span><span class="tAN"> select=</span><span class="tAV">"                 $seriesData/pb:pbcoreDocument                 /pb:pbcoreCoverage[pb:coverageType eq 'Spatial']                 /pb:coverage[matches(., '[0-9]+.*[0-9]*, *\-*[0-9]+.*[0-9]*')]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"XMP-dc:Coverage"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"inputs"</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$exifCoordinates"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"                         $cavafyEntry/pb:pbcoreDocument                         /pb:pbcoreCoverage[pb:coverageType eq 'Spatial']                         /pb:coverage"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"defaultValue"</span><span class="tAN"> select=</span><span class="tAV">"$seriesCoordinates"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Location'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"systemFileSizeMB"</span><span class="tAN"> as=</span><span class="tAV">"xs:decimal"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                         contains(                         $originalExif/rdf:Description                         /System:FileSize, ' GB')"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                             xs:decimal(                             substring-before(                             $originalExif/rdf:Description                             /System:FileSize, ' GB'                             ))                             * 1000"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                         contains($originalExif/rdf:Description/System:FileSize, ' MB')"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                             xs:decimal(                             substring-before(                             $originalExif/rdf:Description                             /System:FileSize, ' MB'))"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                         contains($originalExif/rdf:Description                         /System:FileSize, ' KB')"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                             xs:decimal(                             substring-before(                             $originalExif/rdf:Description                             /System:FileSize, ' KB'))                             div 1000"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:otherwise</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> terminate=</span><span class="tAV">"no"</span><span class="tAN"> select=</span><span class="tAV">"'Unknown System file size!'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"-1"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:otherwise&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDNumChannels"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                         $dbxData/ENTRIES                         /ENTRY/AUDIOMODE = 'Stereo'"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"2"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                         $dbxData/ENTRIES                         /ENTRY/AUDIOMODE = 'Mono'"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"1"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDEncoding"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                         contains(                         $dbxData/ENTRIES                         /ENTRY/AUDIOFORMAT,                         'BWF')"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"'Microsoft PCM'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                         contains(                         $dbxData/ENTRIES                         /ENTRY/MEDIUM                         /FILE[TYPE = 'Audio']                         /FORMAT,                         'Linear')"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"'Microsoft PCM'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:otherwise</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                             $dbxData/ENTRIES                             /ENTRY/MEDIUM                             /FILE[TYPE = 'Audio']                             /FORMAT"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:otherwise&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- DAVID does not output bit depth, 
            so we calculate it using
            the following formula:
         bitDepth (approx) = filesize(bits) / (duration (s) x sampleRate x numChannels)--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDFileSizeBits"</span><span class="tAN"> select=</span><span class="tAV">"xs:integer($dbxData/ENTRIES/ENTRY/FILESIZE * 8)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDFileSizeMB"</span><span class="tAN"> select=</span><span class="tAV">"xs:integer($dbxData/ENTRIES/ENTRY/FILESIZE div 1000000)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDDurationSeconds"</span><span class="tAN"> select=</span><span class="tAV">"$dbxData/ENTRIES/ENTRY/DURATION div 1000"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDSampleRate"</span><span class="tAN"> select=</span><span class="tAV">"$dbxData/ENTRIES/ENTRY/SAMPLERATE"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDApproxBitDepth"</span><span class="tAN"> select=</span><span class="tAV">"$DAVIDFileSizeBits div ($DAVIDDurationSeconds * $DAVIDSampleRate * $DAVIDNumChannels)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDBitDepth"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"floor($DAVIDApproxBitDepth)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDApproxDataRate"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     $dbxData/ENTRIES                     /ENTRY/FILESIZE                     div                     $DAVIDDurationSeconds"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDDataRate"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"round($DAVIDApproxDataRate[. ne ''], -3)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDFileCreateDate"</span><span class="tAN"> select=</span><span class="tAV">"                 $dbxData                 /ENTRIES/ENTRY/MEDIUM                 /FILE[TYPE = 'Audio']                 /CREATEDATE/fn:translate(., '-', ':')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDFileCreateTime"</span><span class="tAN"> select=</span><span class="tAV">"                 $dbxData                 /ENTRIES/ENTRY/MEDIUM                 /FILE[TYPE = 'Audio']                 /CREATETIME/fn:translate(., '-', ':')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDFileCreateDateTime"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     concat(                     $DAVIDFileCreateDate, ' ',                     $DAVIDFileCreateTime, '-4:00')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDFileModifyDate"</span><span class="tAN"> select=</span><span class="tAV">"                 $dbxData                 /ENTRIES/ENTRY                 /CHANGEDATE[. ne '']/fn:translate(., '-', ':')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDFileModifyTime"</span><span class="tAN"> select=</span><span class="tAV">"                 $dbxData                 /ENTRIES/ENTRY                 /CHANGETIME[. ne '']/fn:translate(., '-', ':')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"DAVIDFileModifyDateTime"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                     concat(                     $DAVIDFileModifyDate, ' ',                     $DAVIDFileModifyTime, '-5:00')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"newExif"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:element</span><span class="tAN"> name=</span><span class="tAV">"rdf:Description"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/@rdf:about"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:namespace</span><span class="tAN"> name=</span><span class="tAV">"ExifTool"</span><span class="tAN"> select=</span><span class="tAV">"'http://ns.exiftool.ca/ExifTool/1.0/'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:namespace</span><span class="tAN"> name=</span><span class="tAV">"et"</span><span class="tAN"> select=</span><span class="tAV">"'http://ns.exiftool.ca/1.0/'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:attribute</span><span class="tAN"> name=</span><span class="tAV">"et:toolkit"</span><span class="tAN"> select=</span><span class="tAV">"'Image::ExifTool 10.82'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:namespace</span><span class="tAN"> name=</span><span class="tAV">"System"</span><span class="tAN"> select=</span><span class="tAV">"'http://ns.exiftool.ca/File/System/1.0/'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:namespace</span><span class="tAN"> name=</span><span class="tAV">"File"</span><span class="tAN"> select=</span><span class="tAV">"'http://ns.exiftool.ca/File/1.0/'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:namespace</span><span class="tAN"> name=</span><span class="tAV">"RIFF"</span><span class="tAN"> select=</span><span class="tAV">"'http://ns.exiftool.ca/RIFF/RIFF/1.0/'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:namespace</span><span class="tAN"> name=</span><span class="tAV">"XMP-x"</span><span class="tAN"> select=</span><span class="tAV">"'http://ns.exiftool.ca/XMP/XMP-x/1.0/'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:namespace</span><span class="tAN"> name=</span><span class="tAV">"XMP-xmp"</span><span class="tAN"> select=</span><span class="tAV">"'http://ns.exiftool.ca/XMP/XMP-xmp/1.0/'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:namespace</span><span class="tAN"> name=</span><span class="tAV">"XMP-xmpDM"</span><span class="tAN"> select=</span><span class="tAV">"'http://ns.exiftool.ca/XMP/XMP-xmpDM/1.0/'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:namespace</span><span class="tAN"> name=</span><span class="tAV">"XMP-xmpMM"</span><span class="tAN"> select=</span><span class="tAV">"'http://ns.exiftool.ca/XMP/XMP-xmpMM/1.0/'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:namespace</span><span class="tAN"> name=</span><span class="tAV">"XMP-dc"</span><span class="tAN"> select=</span><span class="tAV">"'http://ns.exiftool.ca/XMP/XMP-dc/1.0/'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:namespace</span><span class="tAN"> name=</span><span class="tAV">"XMP-plus"</span><span class="tAN"> select=</span><span class="tAV">"'http://ns.exiftool.ca/XMP/XMP-plus/1.0/'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:namespace</span><span class="tAN"> name=</span><span class="tAV">"XML"</span><span class="tAN"> select=</span><span class="tAV">"'http://ns.exiftool.ca/XML/XML/1.0/'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:namespace</span><span class="tAN"> name=</span><span class="tAV">"Composite"</span><span class="tAN"> select=</span><span class="tAV">"'http://ns.exiftool.ca/Composite/1.0/'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/ExifTool:ExifToolVersion"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tEl">&lt;System:FileName</span><span class="tEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"contains($originalExif/rdf:Description/File:FileType, 'ASSET')"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                                     concat(                                     $originalExif/rdf:Description/System:FileName,                                     '.00.',                                     $originalExif/rdf:Description/File:FileType)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:otherwise</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/System:FileName"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:otherwise&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
      </span><span class="tEl">&lt;/System:FileName&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/System:Directory"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tEl">&lt;System:FileSize</span><span class="tEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tC">&lt;!-- Checking for files dangerously close to 4 gigs in size --&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                                 upper-case($originalExif/rdf:Description/File:FileType) eq 'WAV'                                 and (                                 $systemFileSizeMB gt 4265                                 or                                 $DAVIDFileSizeMB gt 4265                                 )                                 "</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:element</span><span class="tAN"> name=</span><span class="tAV">"error"</span><span class="tXSLEl">&gt;</span><span class="tI">
              </span><span class="tXSLEl">&lt;xsl:attribute</span><span class="tAN"> name=</span><span class="tAV">"type"</span><span class="tAN"> select=</span><span class="tAV">"                                         'file_too_big'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
              </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                                         'File', $originalExif/rdf:Description/System:FileName,                                         'is dangerously large:', $DAVIDFileSizeMB, 'or', $systemFileSizeMB, 'MB.'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;/xsl:element&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:otherwise</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
              </span><span class="tC">&lt;!-- No file size anywhere --&gt;</span><span class="tI">
              </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"$systemFileSizeMB le 0 and $DAVIDFileSizeMB le 0"</span><span class="tXSLEl">&gt;</span><span class="tI">
                </span><span class="tXSLEl">&lt;xsl:element</span><span class="tAN"> name=</span><span class="tAV">"error"</span><span class="tXSLEl">&gt;</span><span class="tI">
                  </span><span class="tXSLEl">&lt;xsl:attribute</span><span class="tAN"> name=</span><span class="tAV">"type"</span><span class="tAN"> select=</span><span class="tAV">"'missing_file_size'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
                  </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                                                 'no file size for ',                                                 $originalExif/rdf:Description/System:FileName                                                 "</span><span class="tXSLEl">/&gt;</span><span class="tI">
                </span><span class="tXSLEl">&lt;/xsl:element&gt;</span><span class="tI">
              </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
              </span><span class="tC">&lt;!-- Conflicting size values --&gt;</span><span class="tI">
              </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"$systemFileSizeMB[. gt 0] ne $DAVIDFileSizeMB[. gt 0]"</span><span class="tXSLEl">&gt;</span><span class="tI">
                </span><span class="tXSLEl">&lt;xsl:element</span><span class="tAN"> name=</span><span class="tAV">"error"</span><span class="tXSLEl">&gt;</span><span class="tI">
                  </span><span class="tXSLEl">&lt;xsl:attribute</span><span class="tAN"> name=</span><span class="tAV">"type"</span><span class="tAN"> select=</span><span class="tAV">"                                                 'conflicting_file_size'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
                  </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"'Conflicting file size: '"</span><span class="tXSLEl">/&gt;</span><span class="tI">
                  </span><span class="tXSLEl">&lt;xsl:text</span><span class="tXSLEl">/&gt;</span><span class="tI">
                  </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"concat('system: ', $systemFileSizeMB, ' MB.')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
                  </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"concat('DAVID: ', $DAVIDFileSizeMB, ' MB.')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
                </span><span class="tXSLEl">&lt;/xsl:element&gt;</span><span class="tI">
                </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$systemFileSizeMB[. gt 0]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
              </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
              </span><span class="tC">&lt;!-- Filesize in system only --&gt;</span><span class="tI">
              </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"$systemFileSizeMB gt 0"</span><span class="tXSLEl">&gt;</span><span class="tI">
                </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                                             concat($systemFileSizeMB, ' MB')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
              </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
              </span><span class="tC">&lt;!-- Filesize in DAVID only --&gt;</span><span class="tI">
              </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"$DAVIDFileSizeMB gt 0"</span><span class="tXSLEl">&gt;</span><span class="tI">
                </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                                             concat($DAVIDFileSizeMB, ' MB')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
              </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:otherwise&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
      </span><span class="tEl">&lt;/System:FileSize&gt;</span><span class="tI">
      </span><span class="tEl">&lt;System:FileModifyDate</span><span class="tEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/System:FileModifyDate"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"$DAVIDFileModifyDateTime[. ne ' -5:00'][. ne ' -4:00']"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'FileModifyDate'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
      </span><span class="tEl">&lt;/System:FileModifyDate&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/System:FileAccessDate"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tEl">&lt;System:FileCreateDate</span><span class="tEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/System:FileCreateDate"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"$DAVIDFileCreateDateTime[. ne ' -5:00'][. ne ' -4:00']"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'FileCreateDate'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
      </span><span class="tEl">&lt;/System:FileCreateDate&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/System:FilePermissions"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tEl">&lt;File:FileType</span><span class="tEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tC">&lt;!-- Reject RF64 files --&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"contains($originalExif/rdf:Description/File:FileType, 'RF64')"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:element</span><span class="tAN"> name=</span><span class="tAV">"error"</span><span class="tXSLEl">&gt;</span><span class="tI">
              </span><span class="tXSLEl">&lt;xsl:attribute</span><span class="tAN"> name=</span><span class="tAV">"type"</span><span class="tAN"> select=</span><span class="tAV">"'unacceptable_file_type'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
              </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"                                         'Unacceptable file type: ',                                         $originalExif/rdf:Description/File:FileType"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;/xsl:element&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:otherwise</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/File:FileType"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:otherwise&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
      </span><span class="tEl">&lt;/File:FileType&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/File:FileTypeExtension"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"File:FileTypeExtension"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"File:MIMEType"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tEl">&lt;RIFF:Description</span><span class="tEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$parsedDAVIDTitle/parsedElements/DAVIDTitle"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tEl">&lt;/RIFF:Description&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:Originator"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:OriginatorReference"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:Artist"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:Commissioned"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:DateCreated"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:Keywords"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:Subject"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:Software"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:Source"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:ArchivalLocation"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:Comment"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:Copyright"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:Engineer"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:Genre"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:Medium"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:Title"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:Product"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:SourceForm"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:Technician"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/RIFF:DateTimeOriginal[. != '']"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/RIFF:TimeReference[. != '']"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/RIFF:BWFVersion[. != '']"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/RIFF:BWF_UMID[. != '']"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$RIFF:CodingHistory"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:if</span><span class="tAN"> test=</span><span class="tAV">"not(contains($originalExif/rdf:Description/File:FileType, 'ASSET'))"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tEl">&lt;RIFF:Encoding</span><span class="tEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/RIFF:Encoding"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"$DAVIDEncoding"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'Encoding'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
        </span><span class="tEl">&lt;/RIFF:Encoding&gt;</span><span class="tI">
        </span><span class="tEl">&lt;RIFF:NumChannels</span><span class="tEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/RIFF:NumChannels"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"$DAVIDNumChannels"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'NumChannels'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
        </span><span class="tEl">&lt;/RIFF:NumChannels&gt;</span><span class="tI">
        </span><span class="tEl">&lt;RIFF:SampleRate</span><span class="tEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/RIFF:SampleRate"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"$dbxData/ENTRIES/ENTRY/SAMPLERATE"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'SampleRate'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
        </span><span class="tEl">&lt;/RIFF:SampleRate&gt;</span><span class="tI">
        </span><span class="tEl">&lt;RIFF:AvgBytesPerSec</span><span class="tEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:call-template</span><span class="tAN"> name=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/RIFF:AvgBytesPerSec"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"$DAVIDDataRate"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'AvgBytesPerSec'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:call-template&gt;</span><span class="tI">
        </span><span class="tEl">&lt;/RIFF:AvgBytesPerSec&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"bitsPerSample"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tAN"> mode=</span><span class="tAV">"checkConflicts"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field1"</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/RIFF:BitsPerSample"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"field2"</span><span class="tAN"> select=</span><span class="tAV">"$DAVIDBitDepth"</span><span class="tXSLEl">/&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:with-param</span><span class="tAN"> name=</span><span class="tAV">"fieldName"</span><span class="tAN"> select=</span><span class="tAV">"'BitsPerSample'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:apply-templates&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
        </span><span class="tEl">&lt;RIFF:BitsPerSample</span><span class="tEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$bitsPerSample"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tEl">&lt;/RIFF:BitsPerSample&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:if&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/RIFF:CuePoints"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/XML:*"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/XMP-x:*"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tEl">&lt;XMP-dc:Subject</span><span class="tEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:choose</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:when</span><span class="tAN"> test=</span><span class="tAV">"                                 not(                                 contains($generation, 'segment')                                 )"</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$assetKeywordsRDFBag"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:when&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:otherwise</span><span class="tXSLEl">&gt;</span><span class="tI">
            </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$segmentKeywordsRDFBag"</span><span class="tXSLEl">/&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;/xsl:otherwise&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:choose&gt;</span><span class="tI">
      </span><span class="tEl">&lt;/XMP-dc:Subject&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"XMP-dc:Format"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/XMP-xmp:*"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/XMP-xmpDM:*[contains(name(), 'Tracks')]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:element</span><span class="tAN"> name=</span><span class="tAV">"XMP-xmpDM:Artist"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$contributorsAsXMP"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:element&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:if</span><span class="tAN"> test=</span><span class="tAV">"                         $transcript ne '' and                         not(contains($generation, 'segment'))"</span><span class="tXSLEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:element</span><span class="tAN"> name=</span><span class="tAV">"XMP-xmpDM:Lyrics"</span><span class="tXSLEl">&gt;</span><span class="tI">
          </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$transcript"</span><span class="tXSLEl">/&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;/xsl:element&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;/xsl:if&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/XMP-xmpMM:*"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/XMP-dc:Format"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tEl">&lt;XMP-dc:Description</span><span class="tEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"normalize-space($descriptionNoHtml)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tEl">&lt;/XMP-dc:Description&gt;</span><span class="tI">
      </span><span class="tEl">&lt;XMP-plus:ImageSupplierImageID</span><span class="tEl">&gt;</span><span class="tI">
        </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"$cmsImageID"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tEl">&lt;/XMP-plus:ImageSupplierImageID&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$originalExif/rdf:Description/Composite:*"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:element&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$newExif"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:for-each</span><span class="tAN"> select=</span><span class="tAV">"$newExif/rdf:Description/RIFF:*[normalize-space(.) eq '']"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:element</span><span class="tAN"> name=</span><span class="tAV">"error"</span><span class="tXSLEl">&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:attribute</span><span class="tAN"> name=</span><span class="tAV">"type"</span><span class="tAN"> select=</span><span class="tAV">"                         'empty_field'"</span><span class="tXSLEl">/&gt;</span><span class="tI">
      </span><span class="tXSLEl">&lt;xsl:value-of</span><span class="tAN"> select=</span><span class="tAV">"local-name(.)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;/xsl:element&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:for-each&gt;</span><span class="tI">
</span><span class="tXSLEl">&lt;/xsl:template&gt;</span></pre></td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table><a id="T_aapbDataS_exif2NewExif.xsl"></a><div class="cmpT">Template
         <span class="titleTemplateMatch">             rdf:Description/RIFF:Source             [starts-with(., 'http://americanarchive.org/catalog/')]</span><span class="titleTemplateName">aapbData</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">Namespace</td>
                        <td>No namespace</td>
                     </tr>
                     <tr>
                        <td class="fCol">Match</td>
                        <td>             rdf:Description/RIFF:Source             [starts-with(., 'http://americanarchive.org/catalog/')]</td>
                     </tr>
                     <tr>
                        <td class="fCol">Mode</td>
                        <td>#default</td>
                     </tr>
                     <tr>
                        <td class="fCol">Import precedence</td>
                        <td>17</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Source</div>
                           <div class="flR"><input id="bt_src_T_aapbDataS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('src_T_aapbDataS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="src_T_aapbDataS_exif2NewExif.xsl" style="display:block">
                              <table class="pWCont">
                                 <tr>
                                    <td width="100%"><pre><span class="tXSLEl">&lt;xsl:template</span><span class="tAN"> name=</span><span class="tAV">"aapbData"</span><span class="tAN"> match=</span><span class="tAV">"             rdf:Description/RIFF:Source             [starts-with(., 'http://americanarchive.org/catalog/')]"</span><span class="tXSLEl">&gt;</span><span class="tI">
  </span><span class="tC">&lt;!--Obtain data and transcripts
            from American Archive (AAPB) 
            when an AAPB URL is in the RIFF:Source field--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"aapbURL"</span><span class="tAN"> select=</span><span class="tAV">"."</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"aapbData"</span><span class="tAN"> select=</span><span class="tAV">"document($aapbURL)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$aapbData"</span><span class="tXSLEl">/&gt;</span><span class="tI">
</span><span class="tXSLEl">&lt;/xsl:template&gt;</span></pre></td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table><a id="T_aapbData2S_exif2NewExif.xsl"></a><div class="cmpT">Template
         <span class="titleTemplateMatch">             rdf:Description/RIFF:Comment             [contains(., 'http://americanarchive.org/catalog/')]</span><span class="titleTemplateName">aapbData2</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">Namespace</td>
                        <td>No namespace</td>
                     </tr>
                     <tr>
                        <td class="fCol">Match</td>
                        <td>             rdf:Description/RIFF:Comment             [contains(., 'http://americanarchive.org/catalog/')]</td>
                     </tr>
                     <tr>
                        <td class="fCol">Mode</td>
                        <td>#default</td>
                     </tr>
                     <tr>
                        <td class="fCol">Import precedence</td>
                        <td>17</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Source</div>
                           <div class="flR"><input id="bt_src_T_aapbData2S_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('src_T_aapbData2S_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="src_T_aapbData2S_exif2NewExif.xsl" style="display:block">
                              <table class="pWCont">
                                 <tr>
                                    <td width="100%"><pre><span class="tXSLEl">&lt;xsl:template</span><span class="tAN"> name=</span><span class="tAV">"aapbData2"</span><span class="tAN"> match=</span><span class="tAV">"             rdf:Description/RIFF:Comment             [contains(., 'http://americanarchive.org/catalog/')]"</span><span class="tXSLEl">&gt;</span><span class="tI">
  </span><span class="tC">&lt;!--Obtain data and transcripts
            from American Archive (AAPB) 
            when an AAPB URL is in the RIFF:Comment field--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"aapbURL"</span><span class="tAN"> select=</span><span class="tAV">"                 concat(                 'http://americanarchive.org/catalog/',                 substring-before(                 substring-after(                 RIFF:Comment, 'http://americanarchive.org/catalog/'),                 '.pbcore'),                 '.pbcore')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"aapbData"</span><span class="tAN"> select=</span><span class="tAV">"document($aapbURL)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$aapbData"</span><span class="tXSLEl">/&gt;</span><span class="tI">
</span><span class="tXSLEl">&lt;/xsl:template&gt;</span></pre></td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table><a id="M_rdfRDFstarts-withrdfDescriptionRIFFCommenthttpss3.amazonaws.comamericanarchive.orgtranscriptsS_exif2NewExif.xsl"></a><div class="cmpT">Template
         <span class="titleTemplateMatch">rdf:RDF[starts-with(rdf:Description/RIFF:Comment, 'https://s3.amazonaws.com/americanarchive.org/transcripts/')]</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Documentation</div>
                           <div class="flR"><input id="bt_dS_M_rdfRDFstarts-withrdfDescriptionRIFFCommenthttpss3.amazonaws.comamericanarchive.orgtranscriptsS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('dS_M_rdfRDFstarts-withrdfDescriptionRIFFCommenthttpss3.amazonaws.comamericanarchive.orgtranscriptsS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="dS_M_rdfRDFstarts-withrdfDescriptionRIFFCommenthttpss3.amazonaws.comamericanarchive.orgtranscriptsS_exif2NewExif.xsl" style="display:block">
                              <div>
                                 <h3>Description</h3><pre> JSON utility templates </pre></div>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">Namespace</td>
                        <td>No namespace</td>
                     </tr>
                     <tr>
                        <td class="fCol">Match</td>
                        <td>rdf:RDF[starts-with(rdf:Description/RIFF:Comment, 'https://s3.amazonaws.com/americanarchive.org/transcripts/')]</td>
                     </tr>
                     <tr>
                        <td class="fCol">Mode</td>
                        <td>#default</td>
                     </tr>
                     <tr>
                        <td class="fCol">Import precedence</td>
                        <td>17</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Source</div>
                           <div class="flR"><input id="bt_src_M_rdfRDFstarts-withrdfDescriptionRIFFCommenthttpss3.amazonaws.comamericanarchive.orgtranscriptsS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('src_M_rdfRDFstarts-withrdfDescriptionRIFFCommenthttpss3.amazonaws.comamericanarchive.orgtranscriptsS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="src_M_rdfRDFstarts-withrdfDescriptionRIFFCommenthttpss3.amazonaws.comamericanarchive.orgtranscriptsS_exif2NewExif.xsl" style="display:block">
                              <table class="pWCont">
                                 <tr>
                                    <td width="100%"><pre><span class="tXSLEl">&lt;xsl:template</span><span class="tAN"> match=</span><span class="tAV">"rdf:RDF[starts-with(rdf:Description/RIFF:Comment, 'https://s3.amazonaws.com/americanarchive.org/transcripts/')]"</span><span class="tXSLEl">&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"rdf:Description/RIFF:Comment[starts-with(., 'https://s3.amazonaws.com/americanarchive.org/transcripts/')]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
</span><span class="tXSLEl">&lt;/xsl:template&gt;</span></pre></td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table><a id="T_getCMSDataS_exif2NewExif.xsl"></a><div class="cmpT">Template
         <span class="titleTemplateMatch">rdf:Description</span><span class="titleTemplateName">getCMSData</span><span class="titleTemplateMode">getCMSData</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">Namespace</td>
                        <td>No namespace</td>
                     </tr>
                     <tr>
                        <td class="fCol">Match</td>
                        <td>rdf:Description</td>
                     </tr>
                     <tr>
                        <td class="fCol">Mode</td>
                        <td>getCMSData</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Parameters</div>
                           <div class="flR"><input id="bt_prs_T_getCMSDataS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('prs_T_getCMSDataS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="prs_T_getCMSDataS_exif2NewExif.xsl" style="display:block">
                              <table class="attsT">
                                 <thead>
                                    <tr>
                                       <th>QName</th>
                                       <th>Namespace</th>
                                       <th>Select</th>
                                    </tr>
                                 </thead>
                                 <tr>
                                    <td class="fCol">dbxData</td>
                                    <td>No namespace</td>
                                    <td>doc($dbxURI)</td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">dbxURI</td>
                                    <td>No namespace</td>
                                    <td>concat(substring-before(@rdf:about, '.'), '.DBX')</td>
                                 </tr>
                                 <tr>
                                    <td class="fCol">motive</td>
                                    <td>No namespace</td>
                                    <td>$dbxData/ENTRIES/ENTRY/MOTIVE</td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">Import precedence</td>
                        <td>17</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Source</div>
                           <div class="flR"><input id="bt_src_T_getCMSDataS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('src_T_getCMSDataS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="src_T_getCMSDataS_exif2NewExif.xsl" style="display:block">
                              <table class="pWCont">
                                 <tr>
                                    <td width="100%"><pre><span class="tXSLEl">&lt;xsl:template</span><span class="tAN"> name=</span><span class="tAV">"getCMSData"</span><span class="tAN"> match=</span><span class="tAV">"rdf:Description"</span><span class="tAN"> mode=</span><span class="tAV">"getCMSData"</span><span class="tXSLEl">&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"dbxURI"</span><span class="tAN"> select=</span><span class="tAV">"concat(substring-before(@rdf:about, '.'), '.DBX')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"dbxData"</span><span class="tAN"> select=</span><span class="tAV">"doc($dbxURI)"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"motive"</span><span class="tAN"> select=</span><span class="tAV">"$dbxData/ENTRIES/ENTRY/MOTIVE"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tC">&lt;!--        &lt;xsl:message select="*[local-name() = 'EntriesEntryMotive']"/&gt;--&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:apply-templates</span><span class="tAN"> select=</span><span class="tAV">"                 $dbxData/ENTRIES/ENTRY/MOTIVE                 [. != 'news_latest_newscast']                 [not(starts-with(., 'archive_import'))]"</span><span class="tXSLEl">/&gt;</span><span class="tI">
</span><span class="tXSLEl">&lt;/xsl:template&gt;</span></pre></td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table><a id="T_DAVIDdbxS_exif2NewExif.xsl"></a><div class="cmpT">Template
         <span class="titleTemplateMatch">             rdf:Description             [contains(System:Directory, 'wnycdavidmedia')]</span><span class="titleTemplateName">DAVIDdbx</span><span class="titleTemplateMode">DAVIDdbx</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">Namespace</td>
                        <td>No namespace</td>
                     </tr>
                     <tr>
                        <td class="fCol">Match</td>
                        <td>             rdf:Description             [contains(System:Directory, 'wnycdavidmedia')]</td>
                     </tr>
                     <tr>
                        <td class="fCol">Mode</td>
                        <td>DAVIDdbx</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Overriding</div>
                           <div class="flR"><input id="bt_ovr_T_DAVIDdbxS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('ovr_T_DAVIDdbxS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="ovr_T_DAVIDdbxS_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td class="fCol">Template</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter0.html#T_DAVIDdbxS_masterRouter.xsl" target="_self" title="No namespace" onclick="updPT('masterRouter.xsl')"><span class="nRf">DAVIDdbx</span></a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Parameters</div>
                           <div class="flR"><input id="bt_prs_T_DAVIDdbxS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('prs_T_DAVIDdbxS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="prs_T_DAVIDdbxS_exif2NewExif.xsl" style="display:block">
                              <table class="attsT">
                                 <thead>
                                    <tr>
                                       <th>QName</th>
                                       <th>Namespace</th>
                                       <th>Select</th>
                                    </tr>
                                 </thead>
                                 <tr>
                                    <td class="fCol">wavURI</td>
                                    <td>No namespace</td>
                                    <td>translate(concat(System:Directory, '/', System:FileName), '\', '/')</td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">Import precedence</td>
                        <td>17</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Source</div>
                           <div class="flR"><input id="bt_src_T_DAVIDdbxS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('src_T_DAVIDdbxS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="src_T_DAVIDdbxS_exif2NewExif.xsl" style="display:block">
                              <table class="pWCont">
                                 <tr>
                                    <td width="100%"><pre><span class="tXSLEl">&lt;xsl:template</span><span class="tAN"> name=</span><span class="tAV">"DAVIDdbx"</span><span class="tAN"> match=</span><span class="tAV">"             rdf:Description             [contains(System:Directory, 'wnycdavidmedia')]"</span><span class="tAN"> mode=</span><span class="tAV">"DAVIDdbx"</span><span class="tXSLEl">&gt;</span><span class="tI">
  </span><span class="tC">&lt;!-- Obtain DAVID fields --&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:param</span><span class="tAN"> name=</span><span class="tAV">"wavURI"</span><span class="tAN"> select=</span><span class="tAV">"translate(concat(System:Directory, '/', System:FileName), '\', '/')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"'Find DBX file for', $wavURI"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"dbxURI"</span><span class="tAN"> select=</span><span class="tAV">"replace($wavURI, '.WAV', '.DBX')"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"dbxData"</span><span class="tXSLEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"document(concat('file:///', $dbxURI))"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;/xsl:variable&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:message</span><span class="tAN"> select=</span><span class="tAV">"'DBX Data: ', $dbxData"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tEl">&lt;dbxData</span><span class="tEl">&gt;</span><span class="tI">
    </span><span class="tXSLEl">&lt;xsl:copy-of</span><span class="tAN"> select=</span><span class="tAV">"$dbxData[//SOFTDELETED eq '0']"</span><span class="tXSLEl">/&gt;</span><span class="tI">
  </span><span class="tEl">&lt;/dbxData&gt;</span><span class="tI">
</span><span class="tXSLEl">&lt;/xsl:template&gt;</span></pre></td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table><a id="V_illegalCharactersS_exif2NewExif.xsl"></a><div class="cmpT">Variable
         <span class="qname">illegalCharacters</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">Namespace</td>
                        <td>No namespace</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Used by</div>
                           <div class="flR"><input id="bt_uB_V_illegalCharactersS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('uB_V_illegalCharactersS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="uB_V_illegalCharactersS_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td class="fCol">Template</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter9.html#T_exifFillerS_cms2BWFMetaEdit.xsl" target="_self" title="No namespace" onclick="updPT('cms2BWFMetaEdit.xsl')"><span class="nRf">exifFiller</span></a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Supersedes</div>
                           <div class="flR"><input id="bt_sps_V_illegalCharactersS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('sps_V_illegalCharactersS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="sps_V_illegalCharactersS_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td class="fCol">Variable</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter6.html#V_illegalCharactersS_Exif2BWF.xsl" target="_self" title="No namespace" onclick="updPT('Exif2BWF.xsl')">illegalCharacters</a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Source</div>
                           <div class="flR"><input id="bt_src_V_illegalCharactersS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('src_V_illegalCharactersS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="src_V_illegalCharactersS_exif2NewExif.xsl" style="display:block">
                              <table class="pWCont">
                                 <tr>
                                    <td width="100%"><pre><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"illegalCharacters"</span><span class="tXSLEl">&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:text</span><span class="tXSLEl">&gt;</span><span class="tT">&#x80;&#x93;&#x94;</span><span class="tXSLEl">&lt;/xsl:text&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:text</span><span class="tXSLEl">&gt;</span><span class="tT">&#x99;&#x9c;&#x9d;</span><span class="tXSLEl">&lt;/xsl:text&gt;</span><span class="tI">
</span><span class="tXSLEl">&lt;/xsl:variable&gt;</span></pre></td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table><a id="V_legalCharactersS_exif2NewExif.xsl"></a><div class="cmpT">Variable
         <span class="qname">legalCharacters</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">Namespace</td>
                        <td>No namespace</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Used by</div>
                           <div class="flR"><input id="bt_uB_V_legalCharactersS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('uB_V_legalCharactersS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="uB_V_legalCharactersS_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td class="fCol">Template</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter9.html#T_exifFillerS_cms2BWFMetaEdit.xsl" target="_self" title="No namespace" onclick="updPT('cms2BWFMetaEdit.xsl')"><span class="nRf">exifFiller</span></a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Supersedes</div>
                           <div class="flR"><input id="bt_sps_V_legalCharactersS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('sps_V_legalCharactersS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="sps_V_legalCharactersS_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td class="fCol">Variable</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter6.html#V_legalCharactersS_Exif2BWF.xsl" target="_self" title="No namespace" onclick="updPT('Exif2BWF.xsl')">legalCharacters</a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Source</div>
                           <div class="flR"><input id="bt_src_V_legalCharactersS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('src_V_legalCharactersS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="src_V_legalCharactersS_exif2NewExif.xsl" style="display:block">
                              <table class="pWCont">
                                 <tr>
                                    <td width="100%"><pre><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"legalCharacters"</span><span class="tXSLEl">&gt;</span><span class="tI">
  </span><span class="tXSLEl">&lt;xsl:text</span><span class="tXSLEl">&gt;</span><span class="tT">"" ''''</span><span class="tXSLEl">&lt;/xsl:text&gt;</span><span class="tI">
</span><span class="tXSLEl">&lt;/xsl:variable&gt;</span></pre></td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table><a id="V_CMSRolesS_exif2NewExif.xsl"></a><div class="cmpT">Variable
         <span class="qname">CMSRoles</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">Namespace</td>
                        <td>No namespace</td>
                     </tr>
                     <tr>
                        <td class="fCol">Select</td>
                        <td>doc('file:CMSRoles.xml')</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Source</div>
                           <div class="flR"><input id="bt_src_V_CMSRolesS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('src_V_CMSRolesS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="src_V_CMSRolesS_exif2NewExif.xsl" style="display:block">
                              <table class="pWCont">
                                 <tr>
                                    <td width="100%"><pre><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"CMSRoles"</span><span class="tAN"> select=</span><span class="tAV">"doc('file:CMSRoles.xml')"</span><span class="tXSLEl">/&gt;</span></pre></td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table><a id="V_validatingCatalogStringS_exif2NewExif.xsl"></a><div class="cmpT">Variable
         <span class="qname">validatingCatalogString</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">Namespace</td>
                        <td>No namespace</td>
                     </tr>
                     <tr>
                        <td class="fCol">Select</td>
                        <td>'https://cavafy.wnyc.org/assets/'</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Source</div>
                           <div class="flR"><input id="bt_src_V_validatingCatalogStringS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('src_V_validatingCatalogStringS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="src_V_validatingCatalogStringS_exif2NewExif.xsl" style="display:block">
                              <table class="pWCont">
                                 <tr>
                                    <td width="100%"><pre><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"validatingCatalogString"</span><span class="tAN"> select=</span><span class="tAV">"'https://cavafy.wnyc.org/assets/'"</span><span class="tXSLEl">/&gt;</span></pre></td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table><a id="V_validatingKeywordStringS_exif2NewExif.xsl"></a><div class="cmpT">Variable
         <span class="qname">validatingKeywordString</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">Namespace</td>
                        <td>No namespace</td>
                     </tr>
                     <tr>
                        <td class="fCol">Select</td>
                        <td>'id.loc.gov/authorities/subjects/'</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Supersedes</div>
                           <div class="flR"><input id="bt_sps_V_validatingKeywordStringS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('sps_V_validatingKeywordStringS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="sps_V_validatingKeywordStringS_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td class="fCol">Variable</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter15.html#V_validatingKeywordStringS_processLoCURL.xsl" target="_self" title="No namespace" onclick="updPT('processLoCURL.xsl')">validatingKeywordString</a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Overriding</div>
                           <div class="flR"><input id="bt_ovr_V_validatingKeywordStringS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('ovr_V_validatingKeywordStringS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="ovr_V_validatingKeywordStringS_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td class="fCol">Variable</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter18.html#V_validatingKeywordStringS_utilities.xsl" target="_self" title="No namespace" onclick="updPT('utilities.xsl')">validatingKeywordString</a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Source</div>
                           <div class="flR"><input id="bt_src_V_validatingKeywordStringS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('src_V_validatingKeywordStringS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="src_V_validatingKeywordStringS_exif2NewExif.xsl" style="display:block">
                              <table class="pWCont">
                                 <tr>
                                    <td width="100%"><pre><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"validatingKeywordString"</span><span class="tAN"> select=</span><span class="tAV">"'id.loc.gov/authorities/subjects/'"</span><span class="tXSLEl">/&gt;</span></pre></td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table><a id="V_validatingNameStringS_exif2NewExif.xsl"></a><div class="cmpT">Variable
         <span class="qname">validatingNameString</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">Namespace</td>
                        <td>No namespace</td>
                     </tr>
                     <tr>
                        <td class="fCol">Select</td>
                        <td>'id.loc.gov/authorities/names/'</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Supersedes</div>
                           <div class="flR"><input id="bt_sps_V_validatingNameStringS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('sps_V_validatingNameStringS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="sps_V_validatingNameStringS_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td class="fCol">Variable</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter15.html#V_validatingNameStringS_processLoCURL.xsl" target="_self" title="No namespace" onclick="updPT('processLoCURL.xsl')">validatingNameString</a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Overriding</div>
                           <div class="flR"><input id="bt_ovr_V_validatingNameStringS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('ovr_V_validatingNameStringS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="ovr_V_validatingNameStringS_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td class="fCol">Variable</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter18.html#V_validatingNameStringS_utilities.xsl" target="_self" title="No namespace" onclick="updPT('utilities.xsl')">validatingNameString</a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Source</div>
                           <div class="flR"><input id="bt_src_V_validatingNameStringS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('src_V_validatingNameStringS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="src_V_validatingNameStringS_exif2NewExif.xsl" style="display:block">
                              <table class="pWCont">
                                 <tr>
                                    <td width="100%"><pre><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"validatingNameString"</span><span class="tAN"> select=</span><span class="tAV">"'id.loc.gov/authorities/names/'"</span><span class="tXSLEl">/&gt;</span></pre></td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table><a id="V_separatingTokenS_exif2NewExif.xsl"></a><div class="cmpT">Variable
         <span class="qname">separatingToken</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">Namespace</td>
                        <td>No namespace</td>
                     </tr>
                     <tr>
                        <td class="fCol">Select</td>
                        <td>';'</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Supersedes</div>
                           <div class="flR"><input id="bt_sps_V_separatingTokenS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('sps_V_separatingTokenS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="sps_V_separatingTokenS_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td class="fCol">Parameter</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter14.html#P_separatingTokenS_processCollection.xsl" target="_self" title="No namespace" onclick="updPT('processCollection.xsl')">separatingToken</a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Overriding</div>
                           <div class="flR"><input id="bt_ovr_V_separatingTokenS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('ovr_V_separatingTokenS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="ovr_V_separatingTokenS_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td class="fCol">Variable</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter18.html#V_separatingTokenS_utilities.xsl" target="_self" title="No namespace" onclick="updPT('utilities.xsl')">separatingToken</a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Source</div>
                           <div class="flR"><input id="bt_src_V_separatingTokenS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('src_V_separatingTokenS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="src_V_separatingTokenS_exif2NewExif.xsl" style="display:block">
                              <table class="pWCont">
                                 <tr>
                                    <td width="100%"><pre><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"separatingToken"</span><span class="tAN"> select=</span><span class="tAV">"';'"</span><span class="tXSLEl">/&gt;</span></pre></td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table><a id="V_separatingTokenLongS_exif2NewExif.xsl"></a><div class="cmpT">Variable
         <span class="qname">separatingTokenLong</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">Namespace</td>
                        <td>No namespace</td>
                     </tr>
                     <tr>
                        <td class="fCol">Select</td>
                        <td>         concat(' ', $separatingToken, ' ')</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">References</div>
                           <div class="flR"><input id="bt_refs_V_separatingTokenLongS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('refs_V_separatingTokenLongS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="refs_V_separatingTokenLongS_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td class="fCol">Parameter</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter19.html#P_separatingTokenS_cavafySearch.xsl" target="_self" title="No namespace" onclick="updPT('cavafySearch.xsl')">separatingToken</a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Supersedes</div>
                           <div class="flR"><input id="bt_sps_V_separatingTokenLongS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('sps_V_separatingTokenLongS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="sps_V_separatingTokenLongS_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td class="fCol">Variable</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter15.html#V_separatingTokenLongS_processLoCURL.xsl" target="_self" title="No namespace" onclick="updPT('processLoCURL.xsl')">separatingTokenLong</a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Overriding</div>
                           <div class="flR"><input id="bt_ovr_V_separatingTokenLongS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('ovr_V_separatingTokenLongS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="ovr_V_separatingTokenLongS_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td class="fCol">Variable</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter16.html#V_separatingTokenLongS_manageDuplicates.xsl" target="_self" title="No namespace" onclick="updPT('manageDuplicates.xsl')">separatingTokenLong</a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Source</div>
                           <div class="flR"><input id="bt_src_V_separatingTokenLongS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('src_V_separatingTokenLongS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="src_V_separatingTokenLongS_exif2NewExif.xsl" style="display:block">
                              <table class="pWCont">
                                 <tr>
                                    <td width="100%"><pre><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"separatingTokenLong"</span><span class="tAN"> select=</span><span class="tAV">"         concat(' ', $separatingToken, ' ')"</span><span class="tXSLEl">/&gt;</span></pre></td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table><a id="V_separatingTokenForFreeTextFieldsS_exif2NewExif.xsl"></a><div class="cmpT">Variable
         <span class="qname">separatingTokenForFreeTextFields</span></div>
      <table class="rt">
         <tr>
            <td class="rt_cTL"></td>
            <td class="rt_lT"></td>
            <td class="rt_cTR"></td>
         </tr>
         <tr>
            <td class="rt_lL"></td>
            <td class="rt_cnt">
               <table class="component">
                  <tbody>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Documentation</div>
                           <div class="flR"><input id="bt_dS_V_separatingTokenForFreeTextFieldsS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('dS_V_separatingTokenForFreeTextFieldsS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="dS_V_separatingTokenForFreeTextFieldsS_exif2NewExif.xsl" style="display:block">
                              <div>
                                 <h3>Description</h3><pre> To avoid semicolons separating a single field </pre></div>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">Namespace</td>
                        <td>No namespace</td>
                     </tr>
                     <tr>
                        <td class="fCol">Select</td>
                        <td>'###===###'</td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Overriding</div>
                           <div class="flR"><input id="bt_ovr_V_separatingTokenForFreeTextFieldsS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('ovr_V_separatingTokenForFreeTextFieldsS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="ovr_V_separatingTokenForFreeTextFieldsS_exif2NewExif.xsl" style="display:block">
                              <table class="uBT">
                                 <tr>
                                    <td class="fCol">Variable</td>
                                    <td>
                                       <div class="listGrouping">
                                          <div class="refItemBlock"><a href="masterRouter16.html#V_separatingTokenForFreeTextFieldsS_manageDuplicates.xsl" target="_self" title="No namespace" onclick="updPT('manageDuplicates.xsl')">separatingTokenForFreeTextFields</a></div>
                                       </div>
                                    </td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                     <tr>
                        <td class="fCol">
                           <div class="flL">Source</div>
                           <div class="flR"><input id="bt_src_V_separatingTokenForFreeTextFieldsS_exif2NewExif.xsl" type="image" src="img/btM.gif" value="-" onclick="switchState('src_V_separatingTokenForFreeTextFieldsS_exif2NewExif.xsl');" class="control" /></div>
                        </td>
                        <td>
                           <div id="src_V_separatingTokenForFreeTextFieldsS_exif2NewExif.xsl" style="display:block">
                              <table class="pWCont">
                                 <tr>
                                    <td width="100%"><pre><span class="tXSLEl">&lt;xsl:variable</span><span class="tAN"> name=</span><span class="tAV">"separatingTokenForFreeTextFields"</span><span class="tAN"> select=</span><span class="tAV">"'###===###'"</span><span class="tXSLEl">/&gt;</span></pre></td>
                                 </tr>
                              </table>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </td>
            <td class="rt_lR"></td>
         </tr>
         <tr>
            <td class="rt_cBL"></td>
            <td class="rt_lB"></td>
            <td class="rt_cBR"></td>
         </tr>
      </table>
      <div class="footer">
         <hr />
         <div align="center">Stylesheet documentation generated by <a href="http://www.oxygenxml.com" target="_parent"><span class="oXygenLogo"><span class="redX">&lt;</span>o<span class="redX">X</span>ygen<span class="redX">/&gt;</span></span></a><sup></sup> XML Editor.
         </div>
      </div><script type="text/javascript">
         <!--
                    // The namespace is the selected option in the TOC combo.
                    
                    // The corresponding div is already visible conf. to its style attr.                     
                    
                            var selectToc = getElementObject('selectTOC');
                            if(selectToc != null){
                            // It can be null when having chunking, the combo of the TOC is in another frame.
                            selectToc.selectedIndex = 0;
                            }
                        
                    
                    // Floats the toolbar.
                    var globalControls = getElementObject("global_controls"); 
                    
                    if(globalControls != null){
                    var browser=navigator.appName;
                    var version = parseFloat(navigator.appVersion.split('MSIE')[1]);
                    
                    var IE6 = false;
                    if ((browser=="Microsoft Internet Explorer") && (version < 7)){
                    IE6 = true;
                    }
                    
                    //alert (IE6 + " |V| " + version);
                    
                    if(IE6){
                    // On IE 6 the 'fixed' property is not supported. We must use javascript. 
                    globalControls.style.position='absolute';                         
                    // The global controls will do not exist in the TOC frame, when chunking.
                    findAndFloat("global_controls", 225, 30);    
                    } else {
                    globalControls.style.position='fixed';                     	
                    }
                    
                    globalControls.style.right='0';                       
                    }
                //--></script></body>
</html>